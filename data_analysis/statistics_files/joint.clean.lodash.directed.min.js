(function(){function N(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i){if(e[r]===t){return r}}return-1}function C(e,t){var n=e.criteria,r=t.criteria,i=-1,s=n.length;while(++i<s){var o=n[i],u=r[i];if(o!==u){if(o>u||typeof o=="undefined"){return 1}if(o<u||typeof u=="undefined"){return-1}}}return e.index-t.index}function k(e){return"\\"+b[e]}function L(){return t.pop()||[]}function A(e){e.length=0;if(t.length<s){t.push(e)}}function O(e,t,n){t||(t=0);if(typeof n=="undefined"){n=e?e.length:0}var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i){s[r]=e[t+r]}return s}function Q(e){return e instanceof Q?e:new G(e)}function G(e,t){this.____chain____=!!t;this.____wrapped____=e}function Z(e){function i(){if(n){var e=O(n);q.apply(e,arguments)}if(this instanceof i){var s=et(t.prototype),o=t.apply(s,e||arguments);return It(o)?o:s}return t.apply(r,e||arguments)}var t=e[0],n=e[2],r=e[4];return i}function et(e,t){return It(e)?U(e):{}}function tt(e,t,n){if(typeof e!="function"){return tr}if(typeof t=="undefined"||!("prototype"in e)){return e}switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Un(e,t)}function nt(e){function h(){var e=u?s:this;if(r){var p=O(r);q.apply(p,arguments)}if(i||f){p||(p=O(arguments));if(i){q.apply(p,i)}if(f&&p.length<o){n|=16&~32;return nt([t,l?n:n&~3,p,null,s,o])}}p||(p=arguments);if(a){t=e[c]}if(this instanceof h){e=et(t.prototype);var d=t.apply(e,p);return It(d)?d:e}return t.apply(e,p)}var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5];var u=n&1,a=n&2,f=n&4,l=n&8,c=t;return h}function rt(e,t){var n=-1,r=ht(),i=e?e.length:0,s=[];while(++n<i){var o=e[n];if(r(t,o)<0){s.push(o)}}return s}function it(e,t,n,r){var i=(r||0)-1,s=e?e.length:0,o=[];while(++i<s){var u=e[i];if(u&&typeof u=="object"&&typeof u.length=="number"&&(gt(u)||mt(u))){if(!t){u=it(u,t,n)}var a=-1,f=u.length,l=o.length;o.length+=f;while(++a<f){o[l++]=u[a]}}else if(!n){o.push(u)}}return o}function st(e,t,n,i){if(e===t){return e!==0||1/e==1/t}var s=typeof e,o=typeof t;if(e===e&&!(e&&y[s])&&!(t&&y[o])){return false}if(e==null||t==null){return e===t}var u=P.call(e),a=P.call(t);if(u!=a){return false}switch(u){case c:case h:return+e==+t;case d:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case m:case g:return e==String(t)}var f=u==l;if(!f){var p=e instanceof Q,b=t instanceof Q;if(p||b){return st(p?e.____wrapped____:e,b?t.____wrapped____:t,n,i)}if(u!=v){return false}var w=e.constructor,E=t.constructor;if(w!=E&&!(Ft(w)&&w instanceof w&&Ft(E)&&E instanceof E)&&"constructor"in e&&"constructor"in t){return false}}n||(n=[]);i||(i=[]);var S=n.length;while(S--){if(n[S]==e){return i[S]==t}}var x=true,T=0;n.push(e);i.push(t);if(f){T=t.length;x=T==e.length;if(x){while(T--){if(!(x=st(e[T],t[T],n,i))){break}}}}else{kt(t,function(t,s,o){if(I.call(o,s)){T++;return!(x=I.call(e,s)&&st(e[s],t,n,i))&&r}});if(x){kt(e,function(e,t,n){if(I.call(n,t)){return!(x=--T>-1)&&r}})}}n.pop();i.pop();return x}function ot(e,t,n,r,i){(gt(t)?sn:Lt)(t,function(t,s){var o,u,a=t,f=e[s];if(t&&((u=gt(t))||zt(t))){var l=r.length;while(l--){if(o=r[l]==t){f=i[l];break}}if(!o){var c;if(n){a=n(f,t);if(c=typeof a!="undefined"){f=a}}if(!c){f=u?gt(f)?f:[]:zt(f)?f:{}}r.push(t);i.push(f);if(!c){ot(f,t,n,r,i)}}}else{if(n){a=n(f,t);if(typeof a=="undefined"){a=t}}if(typeof a!="undefined"){f=a}}e[s]=f})}function ut(e,t){return e+j(K()*(t-e+1))}function at(e,t,n){var r=-1,i=ht(),s=e?e.length:0,o=[],u=n?[]:o;while(++r<s){var a=e[r],f=n?n(a,r,e):a;if(t?!r||u[u.length-1]!==f:i(u,f)<0){if(n){u.push(f)}o.push(a)}}return o}function ft(e){return function(t,n,r){var i={};n=Zn(n,r,3);var s=-1,o=t?t.length:0;if(typeof o=="number"){while(++s<o){var u=t[s];e(i,u,n(u,s,t),t)}}else{Lt(t,function(t,r,s){e(i,t,n(t,r,s),s)})}return i}}function lt(e,t,n,r,i,s){var o=t&1,u=t&2,a=t&4,f=t&8,l=t&16,c=t&32;if(!u&&!Ft(e)){throw new TypeError}if(l&&!n.length){t&=~16;l=n=false}if(c&&!r.length){t&=~32;c=r=false}var h=t==1||t===17?Z:nt;return h([e,t,n,r,i,s])}function ct(e){return wt[e]}function ht(){var e=(e=Q.indexOf)===Ln?N:e;return e}function pt(e){return typeof e=="function"&&H.test(e)}function dt(e){var t,n;if(!(e&&P.call(e)==v)||(t=e.constructor,Ft(t)&&!(t instanceof t))){return r}kt(e,function(e,t){n=t});return typeof n=="undefined"||I.call(e,n)}function vt(e){return Et[e]}function mt(e){return e&&typeof e=="object"&&typeof e.length=="number"&&P.call(e)==f||false}function Tt(e){if(!e){return e}for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r){for(var i in r){e[i]=r[i]}}}return e}function Nt(e){return It(e)?gt(e)?O(e):Tt({},e):e}function Ct(e){if(!e){return e}for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r){for(var i in r){if(typeof e[i]=="undefined"){e[i]=r[i]}}}}return e}function At(e){var t=[];kt(e,function(e,n){if(Ft(e)){t.push(n)}});return t.sort()}function Ot(e,t){return e?I.call(e,t):false}function Mt(e){var t=-1,n=bt(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function _t(e){return e===true||e===false||e&&typeof e=="object"&&P.call(e)==c||false}function Dt(e){return e&&typeof e=="object"&&P.call(e)==h||false}function Pt(e){return e&&e.nodeType===1||false}function Ht(e){if(!e){return true}if(gt(e)||Xt(e)){return!e.length}for(var t in e){if(I.call(e,t)){return false}}return true}function Bt(e,t){return st(e,t)}function jt(e){return W(e)&&!X(parseFloat(e))}function Ft(e){return typeof e=="function"}function It(e){return!!(e&&y[typeof e])}function qt(e){return Ut(e)&&e!=+e}function Rt(e){return e===null}function Ut(e){return typeof e=="number"||e&&typeof e=="object"&&P.call(e)==d||false}function Wt(e){return e&&y[typeof e]&&P.call(e)==m||false}function Xt(e){return typeof e=="string"||e&&typeof e=="object"&&P.call(e)==g||false}function Vt(e){return typeof e=="undefined"}function $t(e){var t=arguments,n=2;if(!It(e)){return e}if(typeof t[2]!="number"){n=t.length}if(n>3&&typeof t[n-2]=="function"){var r=tt(t[--n-1],t[n--],2)}else if(n>2&&typeof t[n-1]=="function"){r=t[--n]}var i=O(arguments,1,n),s=-1,o=L(),u=L();while(++s<n){ot(e,i[s],r,o,u)}A(o);A(u);return e}function Jt(e){var t=[];kt(e,function(e,n){t.push(n)});t=rt(t,it(arguments,true,false,1));var n=-1,r=t.length,i={};while(++n<r){var s=t[n];i[s]=e[s]}return i}function Kt(e){var t=-1,n=bt(e),r=n.length,i=Array(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function Qt(e){var t=-1,n=it(arguments,true,false,1),r=n.length,i={};while(++t<r){var s=n[t];if(s in e){i[s]=e[s]}}return i}function Gt(e){var t=-1,n=bt(e),r=n.length,i=Array(r);while(++t<r){i[t]=e[n[t]]}return i}function Yt(e,t){var n=ht(),i=e?e.length:0,s=false;if(i&&typeof i=="number"){s=n(e,t)>-1}else{Lt(e,function(e){return(s=e===t)&&r})}return s}function en(e,t,n){var i=true;t=Zn(t,n,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o){if(!(i=!!t(e[s],s,e))){break}}}else{Lt(e,function(e,n,s){return!(i=!!t(e,n,s))&&r})}return i}function tn(e,t,n){var r=[];t=Zn(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number"){while(++i<s){var o=e[i];if(t(o,i,e)){r.push(o)}}}else{Lt(e,function(e,n,i){if(t(e,n,i)){r.push(e)}})}return r}function nn(e,t,n){t=Zn(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number"){while(++i<s){var o=e[i];if(t(o,i,e)){return o}}}else{var u;Lt(e,function(e,n,i){if(t(e,n,i)){u=e;return r}});return u}}function rn(e,t){return xn(e,t,true)}function sn(e,t,n){var i=-1,s=e?e.length:0;t=t&&typeof n=="undefined"?t:tt(t,n,3);if(typeof s=="number"){while(++i<s){if(t(e[i],i,e)===r){break}}}else{Lt(e,t)}}function on(e,t){var n=e?e.length:0;if(typeof n=="number"){while(n--){if(t(e[n],n,e)===false){break}}}else{var i=bt(e);n=i.length;Lt(e,function(e,s,o){s=i?i[--n]:--n;return t(o[s],s,o)===false&&r})}}function fn(e,t){var n=O(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Array(typeof s=="number"?s:0);sn(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)});return o}function ln(e,t,n){var r=-1,i=e?e.length:0;t=Zn(t,n,3);if(typeof i=="number"){var s=Array(i);while(++r<i){s[r]=t(e[r],r,e)}}else{s=[];Lt(e,function(e,n,i){s[++r]=t(e,n,i)})}return s}function cn(e,t,n){var r=-Infinity,i=r;if(typeof t!="function"&&n&&n[t]===e){t=null}var s=-1,o=e?e.length:0;if(t==null&&typeof o=="number"){while(++s<o){var u=e[s];if(u>i){i=u}}}else{t=Zn(t,n,3);sn(e,function(e,n,s){var o=t(e,n,s);if(o>r){r=o;i=e}})}return i}function hn(e,t,n){var r=Infinity,i=r;if(typeof t!="function"&&n&&n[t]===e){t=null}var s=-1,o=e?e.length:0;if(t==null&&typeof o=="number"){while(++s<o){var u=e[s];if(u<i){i=u}}}else{t=Zn(t,n,3);sn(e,function(e,n,s){var o=t(e,n,s);if(o<r){r=o;i=e}})}return i}function dn(e,t,n,r){if(!e)return n;var i=arguments.length<3;t=Zn(t,r,4);var s=-1,o=e.length;if(typeof o=="number"){if(i){n=e[++s]}while(++s<o){n=t(n,e[s],s,e)}}else{Lt(e,function(e,r,s){n=i?(i=false,e):t(n,e,r,s)})}return n}function vn(e,t,n,r){var i=arguments.length<3;t=Zn(t,r,4);on(e,function(e,r,s){n=i?(i=false,e):t(n,e,r,s)});return n}function mn(e,t,n){t=Zn(t,n,3);return tn(e,function(e,n,r){return!t(e,n,r)})}function gn(t,n,r){if(t&&typeof t.length!="number"){t=Gt(t)}if(n==null||r){return t?t[ut(0,t.length-1)]:e}var i=yn(t);i.length=J($(0,n),i.length);return i}function yn(e){var t=-1,n=e?e.length:0,r=Array(typeof n=="number"?n:0);sn(e,function(e){var n=ut(0,++t);r[t]=r[n];r[n]=e});return r}function bn(e){var t=e?e.length:0;return typeof t=="number"?t:bt(e).length}function wn(e,t,n){var i;t=Zn(t,n,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o){if(i=t(e[s],s,e)){break}}}else{Lt(e,function(e,n,s){return(i=t(e,n,s))&&r})}return!!i}function En(e,t,n){var r=-1,i=e?e.length:0,s=Array(typeof i=="number"?i:0);t=Zn(t,n,3);sn(e,function(e,n,i){s[++r]={criteria:[t(e,n,i)],index:r,value:e}});i=s.length;s.sort(C);while(i--){s[i]=s[i].value}return s}function Sn(e){if(gt(e)){return O(e)}if(e&&typeof e.length=="number"){return ln(e)}return Gt(e)}function xn(t,n,r){return r&&Ht(n)?e:(r?nn:tn)(t,n)}function Tn(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];if(i){r.push(i)}}return r}function Nn(e){return rt(e,it(arguments,true,true,1))}function Cn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=-1;n=Zn(n,r,3);while(++o<s&&n(t[o],o,t)){i++}}else{i=n;if(i==null||r){return t?t[0]:e}}return O(t,0,J($(0,i),s))}function kn(e,t){return it(e,t)}function Ln(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?$(0,r+n):n||0}else if(n){var i=Hn(e,t);return e[i]===t?i:-1}return N(e,t,n)}function An(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=i;t=Zn(t,n,3);while(s--&&t(e[s],s,e)){r++}}else{r=t==null||n?1:t||r}return O(e,0,J($(0,i-r),i))}function On(){var e=[],t=-1,n=arguments.length;while(++t<n){var r=arguments[t];if(gt(r)||mt(r)){e.push(r)}}var i=e[0],s=-1,o=ht(),u=i?i.length:0,a=[];e:while(++s<u){r=i[s];if(o(a,r)<0){var t=n;while(--t){if(o(e[t],r)<0){continue e}}a.push(r)}}return a}function Mn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=s;n=Zn(n,r,3);while(o--&&n(t[o],o,t)){i++}}else{i=n;if(i==null||r){return t?t[s-1]:e}}return O(t,$(0,s-i))}function _n(e,t,n){var r=e?e.length:0;if(typeof n=="number"){r=(n<0?$(0,r+n):J(n,r-1))+1}while(r--){if(e[r]===t){return r}}return-1}function Dn(e,t,n){e=+e||0;n=+n||1;if(t==null){t=e;e=0}var r=-1,i=$(0,B((t-e)/n)),s=Array(i);while(++r<i){s[r]=e;e+=n}return s}function Pn(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=Zn(t,n,3);while(++i<s&&t(e[i],i,e)){r++}}else{r=t==null||n?1:$(0,t)}return O(e,r)}function Hn(e,t,n,r){var i=0,s=e?e.length:i;n=n?Zn(n,r,1):tr;t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function Bn(){return at(it(arguments,true,true))}function jn(e,t,n,r){if(typeof t!="boolean"&&t!=null){r=n;n=typeof t!="function"&&r&&r[t]===e?null:t;t=false}if(n!=null){n=Zn(n,r,3)}return at(e,t,n)}function Fn(e){return rt(e,O(arguments,1))}function In(){var e=-1,t=cn(pn(arguments,"length")),n=Array(t<0?0:t);while(++e<t){n[e]=pn(arguments,e)}return n}function qn(e,t){var n=-1,r=e?e.length:0,i={};if(!t&&r&&!gt(e[0])){t=[]}while(++n<r){var s=e[n];if(t){i[s]=t[n]}else if(s){i[s[0]]=s[1]}}return i}function Rn(e,t){if(!Ft(t)){throw new TypeError}return function(){if(--e<1){return t.apply(this,arguments)}}}function Un(e,t){return arguments.length>2?lt(e,17,O(arguments,2),null,t):lt(e,1,null,null,t)}function zn(e){var t=arguments.length>1?it(arguments,true,false,1):At(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=lt(e[i],1,null,null,e)}return e}function Wn(){var e=arguments,t=e.length;while(t--){if(!Ft(e[t])){throw new TypeError}}return function(){var t=arguments,n=e.length;while(n--){t=[e[n].apply(this,t)]}return t[0]}}function Xn(t,n,r){var i,s,o,u,a,f,l,c=0,h=false,p=true;if(!Ft(t)){throw new TypeError}n=$(0,n)||0;if(r===true){var d=true;p=false}else if(It(r)){d=r.leading;h="maxWait"in r&&($(n,r.maxWait)||0);p="trailing"in r?r.trailing:p}var v=function(){var r=n-(sr()-u);if(r<=0){if(s){clearTimeout(s)}var h=l;s=f=l=e;if(h){c=sr();o=t.apply(a,i);if(!f&&!s){i=a=null}}}else{f=setTimeout(v,r)}};var m=function(){if(f){clearTimeout(f)}s=f=l=e;if(p||h!==n){c=sr();o=t.apply(a,i);if(!f&&!s){i=a=null}}};return function(){i=arguments;u=sr();a=this;l=p&&(f||!d);if(h===false){var e=d&&!f}else{if(!s&&!d){c=u}var r=h-(u-c),g=r<=0;if(g){if(s){s=clearTimeout(s)}c=u;o=t.apply(a,i)}else if(!s){s=setTimeout(m,r)}}if(g&&f){f=clearTimeout(f)}else if(!f&&n!==h){f=setTimeout(v,n)}if(e){g=true;o=t.apply(a,i)}if(g&&!f&&!s){i=a=null}return o}}function Vn(t){if(!Ft(t)){throw new TypeError}var n=O(arguments,1);return setTimeout(function(){t.apply(e,n)},1)}function $n(t,n){if(!Ft(t)){throw new TypeError}var r=O(arguments,2);return setTimeout(function(){t.apply(e,r)},n)}function Jn(e,t){var n={};return function(){var r=t?t.apply(this,arguments):i+arguments[0];return I.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}}function Kn(e){var t,n;if(!Ft(e)){throw new TypeError}return function(){if(t){return n}t=true;n=e.apply(this,arguments);e=null;return n}}function Qn(e){return lt(e,16,O(arguments,1))}function Gn(e,t,n){var r=true,i=true;if(!Ft(e)){throw new TypeError}if(n===false){r=false}else if(It(n)){r="leading"in n?n.leading:r;i="trailing"in n?n.trailing:i}n={};n.leading=r;n.maxWait=t;n.trailing=i;return Xn(e,t,n)}function Yn(e,t){return lt(t,16,[e])}function Zn(e,t,n){var r=typeof e;if(e==null||r=="function"){return tt(e,t,n)}if(r!="object"){return or(e)}var i=bt(e);return function(t){var n=i.length,r=false;while(n--){if(!(r=t[i[n]]===e[i[n]])){break}}return r}}function er(e){return e==null?"":String(e).replace(xt,ct)}function tr(e){return e}function nr(e){sn(At(e),function(t){var n=Q[t]=e[t];Q.prototype[t]=function(){var e=[this.____wrapped____];q.apply(e,arguments);var t=n.apply(Q,e);return this.____chain____?new G(t,true):t}})}function rr(){w.__=D;return this}function ir(){}function or(e){return function(t){return t[e]}}function ur(e,t){if(e==null&&t==null){t=1}e=+e||0;if(t==null){t=e;e=0}else{t=+t||0}return e+j(K()*(t-e+1))}function ar(e,t){if(e){var n=e[t];return Ft(n)?e[t]():n}}function fr(e,t,n){var r=Q,i=r.templateSettings;e=String(e||"");n=Ct({},n,i);var s=0,o="____p += '",f=n.variable;var l=RegExp((n.escape||u).source+"|"+(n.interpolate||u).source+"|"+(n.evaluate||u).source+"|$","g");e.replace(l,function(t,n,r,i,u){o+=e.slice(s,u).replace(a,k);if(n){o+="' +\n__.escape("+n+") +\n'"}if(i){o+="';\n"+i+";\n____p += '"}if(r){o+="' +\n((____t = ("+r+")) == null ? '' : ____t) +\n'"}s=u+t.length;return t});o+="';\n";if(!f){f="obj";o="with ("+f+" || {}) {\n"+o+"\n}\n"}o="function("+f+") {\n"+"var ____t, ____p = '', ____j = Array.prototype.join;\n"+"function print() { ____p += ____j.call(arguments, '') }\n"+o+"return ____p\n}";try{var c=Function("__","return "+o)(r)}catch(h){h.source=o;throw h}if(t){return c(t)}c.source=o;return c}function lr(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=Array(e);t=tt(t,n,1);while(++r<e){i[r]=t(r)}return i}function cr(e){return e==null?"":String(e).replace(St,vt)}function hr(e){var t=++n+"";return e?e+t:t}function pr(e){e=new G(e);e.____chain____=true;return e}function dr(e,t){t(e);return e}function vr(){this.____chain____=true;return this}function mr(){return this.____wrapped____}var e;var t=[];var n=0;var r={};var i=+(new Date)+"";var s=40;var o=/<%=([\s\S]+?)%>/g;var u=/($^)/;var a=/['\n\r\t\u2028\u2029\\]/g;var f="[object Arguments]",l="[object Array]",c="[object Boolean]",h="[object Date]",p="[object Function]",d="[object Number]",v="[object Object]",m="[object RegExp]",g="[object String]";var y={"boolean":false,"function":true,object:true,number:false,string:false,"undefined":false};var b={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};var w=y[typeof window]&&window||this;var E=y[typeof exports]&&exports&&!exports.nodeType&&exports;var S=y[typeof module]&&module&&!module.nodeType&&module;var x=S&&S.exports===E&&E;var T=y[typeof global]&&global;if(T&&(T.global===T||T.window===T)){w=T}var M=[];var _=Object.prototype;var D=w.__;var P=_.toString;var H=RegExp("^"+String(P).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var B=Math.ceil,j=Math.floor,F=pt(F=Object.getPrototypeOf)&&F,I=_.hasOwnProperty,q=M.push,R=_.propertyIsEnumerable;var U=pt(U=Object.create)&&U,z=pt(z=Array.isArray)&&z,W=w.isFinite,X=w.isNaN,V=pt(V=Object.keys)&&V,$=Math.max,J=Math.min,K=Math.random;G.prototype=Q.prototype;var Y={};(function(){var e={0:1,length:1};Y.spliceObjects=(M.splice.call(e,0,1),!e[0])})(1);Q.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:o,variable:""};if(!U){et=function(){function e(){}return function(t){if(It(t)){e.prototype=t;var n=new e;e.prototype=null}return n||w.Object()}}()}if(!mt(arguments)){mt=function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&I.call(e,"callee")&&!R.call(e,"callee")||false}}var gt=z||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&P.call(e)==l||false};var yt=function(e){var t,n=e,r=[];if(!n)return r;if(!y[typeof e])return r;for(t in n){if(I.call(n,t)){r.push(t)}}return r};var bt=!V?yt:function(e){if(!It(e)){return[]}return V(e)};var wt={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};var Et=Mt(wt);var St=RegExp("("+bt(Et).join("|")+")","g"),xt=RegExp("["+bt(wt).join("")+"]","g");var kt=function(e,t){var n,i=e,s=i;if(!i)return s;if(!y[typeof i])return s;for(n in i){if(t(i[n],n,e)===r)return s}return s};var Lt=function(e,t){var n,i=e,s=i;if(!i)return s;if(!y[typeof i])return s;for(n in i){if(I.call(i,n)){if(t(i[n],n,e)===r)return s}}return s};if(Ft(/x/)){Ft=function(e){return typeof e=="function"&&P.call(e)==p}}var zt=!F?dt:function(e){if(!(e&&P.call(e)==v)){return false}var t=e.valueOf,n=pt(t)&&(n=F(t))&&F(n);return n?e==n||F(e)==n:dt(e)};var Zt=ft(function(e,t,n){I.call(e,n)?e[n]++:e[n]=1});var un=ft(function(e,t,n){(I.call(e,n)?e[n]:e[n]=[]).push(t)});var an=ft(function(e,t,n){e[n]=t});var pn=ln;var sr=pt(sr=Date.now)&&sr||function(){return(new Date).getTime()};Q.after=Rn;Q.bind=Un;Q.bindAll=zn;Q.chain=pr;Q.compact=Tn;Q.compose=Wn;Q.countBy=Zt;Q.debounce=Xn;Q.defaults=Ct;Q.defer=Vn;Q.delay=$n;Q.difference=Nn;Q.filter=tn;Q.flatten=kn;Q.foreach=sn;Q.functions=At;Q.groupBy=un;Q.indexBy=an;Q.initial=An;Q.intersection=On;Q.invert=Mt;Q.invoke=fn;Q.keys=bt;Q.map=ln;Q.max=cn;Q.memoize=Jn;Q.merge=$t;Q.min=hn;Q.omit=Jt;Q.once=Kn;Q.pairs=Kt;Q.partial=Qn;Q.pick=Qt;Q.pluck=pn;Q.range=Dn;Q.reject=mn;Q.rest=Pn;Q.shuffle=yn;Q.sortBy=En;Q.tap=dr;Q.throttle=Gn;Q.times=lr;Q.toArray=Sn;Q.union=Bn;Q.uniq=jn;Q.values=Gt;Q.where=xn;Q.without=Fn;Q.wrap=Yn;Q.zip=In;Q.collect=ln;Q.drop=Pn;Q.extend=Tt;Q.methods=At;Q.object=qn;Q.select=tn;Q.tail=Pn;Q.unique=jn;Q.each=sn;Q.clone=Nt;Q.contains=Yt;Q.escape=er;Q.every=en;Q.find=nn;Q.has=Ot;Q.identity=tr;Q.indexOf=Ln;Q.isArguments=mt;Q.isArray=gt;Q.isBoolean=_t;Q.isDate=Dt;Q.isElement=Pt;Q.isEmpty=Ht;Q.isEqual=Bt;Q.isFinite=jt;Q.isFunction=Ft;Q.isNaN=qt;Q.isNull=Rt;Q.isNumber=Ut;Q.isObject=It;Q.isRegExp=Wt;Q.isString=Xt;Q.isUndefined=Vt;Q.lastIndexOf=_n;Q.mixin=nr;Q.noConflict=rr;Q.random=ur;Q.reduce=dn;Q.reduceRight=vn;Q.result=ar;Q.size=bn;Q.some=wn;Q.sortedIndex=Hn;Q.template=fr;Q.unescape=cr;Q.uniqueId=hr;Q.all=en;Q.any=wn;Q.detect=nn;Q.findWhere=rn;Q.foldl=dn;Q.foldr=vn;Q.include=Yt;Q.inject=dn;Q.first=Cn;Q.last=Mn;Q.sample=gn;Q.take=Cn;Q.head=Cn;nr(Q);Q.VERSION="2.4.1";Q.prototype.chain=vr;Q.prototype.value=mr;sn(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=M[e];Q.prototype[e]=function(){var e=this.____wrapped____;t.apply(e,arguments);if(!Y.spliceObjects&&e.length===0){delete e[0]}return this}});sn(["concat","join","slice"],function(e){var t=M[e];Q.prototype[e]=function(){var e=this.____wrapped____,n=t.apply(e,arguments);if(this.____chain____){n=new G(n);n.____chain____=true}return n}});if(E&&S){if(x){(S.exports=Q).__=Q}else{E.__=Q}}else{w.__=Q}}).call(this);if(typeof exports==="object"){var _=require("lodash")}var joint={version:"0.9.2",dia:{},ui:{},layout:{},shapes:{},format:{},connectors:{},routers:{},util:{hashCode:function(e){var t=0;if(e.length==0)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r;t=t&t}return t},getByPath:function(e,t,n){n=n||".";var r=t.split(n);var i;while(r.length){i=r.shift();if(i in e){e=e[i]}else{return undefined}}return e},setByPath:function(e,t,n,r){r=r||".";var i=t.split(r);var s=e;var o=0;if(t.indexOf(r)>-1){for(var u=i.length;o<u-1;o++){s=s[i[o]]||(s[i[o]]={})}s[i[u-1]]=n}else{e[t]=n}return e},unsetByPath:function(e,t,n){n=n||".";var r=t.lastIndexOf(n);if(r>-1){var i=joint.util.getByPath(e,t.substr(0,r),n);if(i){delete i[t.slice(r+1)]}}else{delete e[t]}return e},flattenObject:function(e,t,n){t=t||".";var r={};for(var i in e){if(!e.hasOwnProperty(i))continue;var s=typeof e[i]==="object";if(s&&n&&n(e[i])){s=false}if(s){var o=this.flattenObject(e[i],t,n);for(var u in o){if(!o.hasOwnProperty(u))continue;r[i+t+u]=o[u]}}else{r[i]=e[i]}}return r},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},guid:function(e){this.guid.id=this.guid.id||1;e.id=e.id===undefined?"j_"+this.guid.id++:e.id;return e.id},mixin:function(){var e=arguments[0];for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(Object(r)!==r&&!__.isFunction(r)&&(r===null||r===undefined)){continue}__.each(r,function(t,n){if(this.mixin.deep&&Object(t)===t){if(!e[n]){e[n]=__.isArray(t)?[]:{}}this.mixin(e[n],t);return}if(e[n]!==t){if(!this.mixin.supplement||!e.hasOwnProperty(n)){e[n]=t}}},this)}return e},supplement:function(){this.mixin.supplement=true;var e=this.mixin.apply(this,arguments);this.mixin.supplement=false;return e},deepMixin:function(){this.mixin.deep=true;var e=this.mixin.apply(this,arguments);this.mixin.deep=false;return e},deepSupplement:function(){this.mixin.deep=this.mixin.supplement=true;var e=this.mixin.apply(this,arguments);this.mixin.deep=this.mixin.supplement=false;return e},normalizeEvent:function(e){return e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length?e.originalEvent.changedTouches[0]:e},nextFrame:function(){var e;var t=typeof window!="undefined";if(t){e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}if(!e){var n=0;e=function(e){var t=(new Date).getTime();var r=Math.max(0,16-(t-n));var i=setTimeout(function(){e(t+r)},r);n=t+r;return i}}return t?__.bind(e,window):e}(),cancelFrame:function(){var e;var t=typeof window!="undefined";if(t){e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame}e=e||clearTimeout;return t?__.bind(e,window):e}(),breakText:function(e,t,n,r){r=r||{};var i=t.width;var s=t.height;var o=r.svgDocument||V("svg").node;var u=V("<text><tspan></tspan></text>").attr(n||{}).node;var a=u.firstChild;var f=document.createTextNode("");a.appendChild(f);o.appendChild(u);if(!r.svgDocument){document.body.appendChild(o)}var l=e.split(" ");var c=[];var h=[];var p;for(var d=0,v=0,m=l.length;d<m;d++){var g=l[d];f.data=h[v]?h[v]+" "+g:g;if(a.getComputedTextLength()<=i){h[v]=f.data;if(p){c[v++]=true;p=0}}else{if(!h[v]||p){var y=!!p;p=g.length-1;if(y||!p){if(!p){if(!h[v]){h=[];break}l.splice(d,2,g+l[d+1]);m--;c[v++]=true;d--;continue}l[d]=g.substring(0,p);l[d+1]=g.substring(p)+l[d+1]}else{l.splice(d,1,g.substring(0,p),g.substring(p));m++;if(v&&!c[v-1]){v--}}d--;continue}v++;d--}if(typeof s!=="undefined"){var b=b||u.getBBox().height*1.25;if(b*h.length>s){h.splice(Math.floor(s/b));break}}}if(r.svgDocument){o.removeChild(u)}else{document.body.removeChild(o)}return h.join("\n")},imageToDataUri:function(e,t){if(e.substr(0,"data:".length)==="data:"){return setTimeout(function(){t(null,e)},0)}var n=document.createElement("canvas");var r=document.createElement("img");r.onload=function(){var i=n.getContext("2d");n.width=r.width;n.height=r.height;i.drawImage(r,0,0);try{var s=e.split(".").pop()||"png";var o="image/"+(s==="jpg")?"jpeg":s;var u=n.toDataURL(o)}catch(a){if(/\.svg$/.test(e)){var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.open("GET",e,false);f.send(null);var l=f.responseText;return t(null,"data:image/svg+xml,"+encodeURIComponent(l))}console.error(r.src,"fails to convert",a)}t(null,u)};r.ononerror=function(){t(new Error("Failed to load image."))};r.src=e},timing:{linear:function(e){return e},quad:function(e){return e*e},cubic:function(e){return e*e*e},inout:function(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)},exponential:function(e){return Math.pow(2,10*(e-1))},bounce:function(e){for(var t=0,n=1;1;t+=n,n/=2){if(e>=(7-4*t)/11){var r=(11-6*t-11*e)/4;return-r*r+n*n}}},reverse:function(e){return function(t){return 1-e(1-t)}},reflect:function(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}},clamp:function(e,t,n){t=t||0;n=n||1;return function(r){var i=e(r);return i<t?t:i>n?n:i}},back:function(e){if(!e)e=1.70158;return function(t){return t*t*((e+1)*t-e)}},elastic:function(e){if(!e)e=1.5;return function(t){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*e/3*t)}}},interpolate:{number:function(e,t){var n=t-e;return function(t){return e+n*t}},object:function(e,t){var n=__.keys(e);return function(r){var i,o,u={};for(i=n.length-1;i!=-1;i--){o=n[i];u[o]=e[o]+(t[o]-e[o])*r}return u}},hexColor:function(e,t){var n=parseInt(e.slice(1),16),r=parseInt(t.slice(1),16);var i=n&255,s=(r&255)-i;var o=n&65280,u=(r&65280)-o;var a=n&16711680,f=(r&16711680)-a;return function(e){var t=i+s*e&255;var n=o+u*e&65280;var r=a+f*e&16711680;return"#"+(1<<24|t|n|r).toString(16).slice(1)}},unit:function(e,t){var n=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;var r=n.exec(e),i=n.exec(t);var s=i[1].indexOf("."),o=s>0?i[1].length-s-1:0;var e=+r[1],u=+i[1]-e,a=r[2];return function(t){return(e+u*t).toFixed(o)+a}}},filter:{blur:function(e){var t=__.isFinite(e.x)?e.x:2;return __.template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>',{stdDeviation:__.isFinite(e.y)?[t,e.y]:t})},dropShadow:function(e){var t="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return __.template(t,{dx:e.dx||0,dy:e.dy||0,opacity:__.isFinite(e.opacity)?e.opacity:1,color:e.color||"black",blur:__.isFinite(e.blur)?e.blur:4})},grayscale:function(e){var t=__.isFinite(e.amount)?e.amount:1;return __.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>',{a:.2126+.7874*(1-t),b:.7152-.7152*(1-t),c:.0722-.0722*(1-t),d:.2126-.2126*(1-t),e:.7152+.2848*(1-t),f:.0722-.0722*(1-t),g:.2126-.2126*(1-t),h:.0722+.9278*(1-t)})},sepia:function(e){var t=__.isFinite(e.amount)?e.amount:1;return __.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>',{a:.393+.607*(1-t),b:.769-.769*(1-t),c:.189-.189*(1-t),d:.349-.349*(1-t),e:.686+.314*(1-t),f:.168-.168*(1-t),g:.272-.272*(1-t),h:.534-.534*(1-t),i:.131+.869*(1-t)})},saturate:function(e){var t=__.isFinite(e.amount)?e.amount:1;return __.template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>',{amount:1-t})},hueRotate:function(e){return __.template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>',{angle:e.angle||0})},invert:function(e){var t=__.isFinite(e.amount)?e.amount:1;return __.template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>',{amount:t,amount2:1-t})},brightness:function(e){return __.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>',{amount:__.isFinite(e.amount)?e.amount:1})},contrast:function(e){var t=__.isFinite(e.amount)?e.amount:1;return __.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>',{amount:t,amount2:.5-t/2})}},format:{number:function(e,t,n){function N(e){var t=e.length;var r=[];var i=0;var s=n.grouping[0];while(t>0&&s>0){r.push(e.substring(t-=s,t+s));s=n.grouping[i=(i+1)%n.grouping.length]}return r.reverse().join(n.thousands)}n=n||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var r=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var i=r.exec(e);var s=i[1]||" ";var o=i[2]||">";var u=i[3]||"";var a=i[4]||"";var f=i[5];var l=+i[6];var c=i[7];var h=i[8];var p=i[9];var d=1;var v="";var m="";var g=false;if(h)h=+h.substring(1);if(f||s==="0"&&o==="="){f=s="0";o="=";if(c)l-=Math.floor((l-1)/4)}switch(p){case"n":c=true;p="g";break;case"%":d=100;m="%";p="f";break;case"p":d=100;m="%";p="r";break;case"b":case"o":case"x":case"X":if(a==="#")v="0"+p.toLowerCase();case"c":case"d":g=true;h=0;break;case"s":d=-1;p="r";break}if(a==="$"){v=n.currency[0];m=n.currency[1]}if(p=="r"&&!h)p="g";if(h!=null){if(p=="g")h=Math.max(1,Math.min(21,h));else if(p=="e"||p=="f")h=Math.max(0,Math.min(20,h))}var y=f&&c;if(g&&t%1)return"";var b=t<0||t===0&&1/t<0?(t=-t,"-"):u;var w=m;if(d<0){var E=this.prefix(t,h);t=E.scale(t);w=E.symbol+m}else{t*=d}t=this.convert(p,t,h);var S=t.lastIndexOf(".");var x=S<0?t:t.substring(0,S);var T=S<0?"":n.decimal+t.substring(S+1);if(!f&&c&&n.grouping){x=N(x)}var C=v.length+x.length+T.length+(y?0:b.length);var k=C<l?(new Array(C=l-C+1)).join(s):"";if(y)x=N(k+x);b+=v;t=x+T;return(o==="<"?b+t+k:o===">"?k+b+t:o==="^"?k.substring(0,C>>=1)+b+t+k.substring(C):b+(y?t:k+t))+w},string:function(e,t){var n;var r="{";var i=false;var s=[];while((n=e.indexOf(r))!==-1){var o,u,a;o=e.slice(0,n);if(i){u=o.split(":");a=u.shift().split(".");o=t;for(var f=0;f<a.length;f++)o=o[a[f]];if(u.length)o=this.number(u,o)}s.push(o);e=e.slice(n+1);r=(i=!i)?"}":"{"}s.push(e);return s.join("")},convert:function(e,t,n){switch(e){case"b":return t.toString(2);case"c":return String.fromCharCode(t);case"o":return t.toString(8);case"x":return t.toString(16);case"X":return t.toString(16).toUpperCase();case"g":return t.toPrecision(n);case"e":return t.toExponential(n);case"f":return t.toFixed(n);case"r":return(t=this.round(t,this.precision(t,n))).toFixed(Math.max(0,Math.min(20,this.precision(t*(1+1e-15),n))));default:return t+""}},round:function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},precision:function(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)},prefix:function(e,t){var n=__.map(["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"],function(e,t){var n=Math.pow(10,abs(8-t)*3);return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}});var r=0;if(e){if(e<0)e*=-1;if(t)e=d3.round(e,this.precision(e,t));r=1+Math.floor(1e-12+Math.log(e)/Math.LN10);r=Math.max(-24,Math.min(24,Math.floor((r<=0?r+1:r-1)/3)*3))}return n[8+r/3]}}}};if(typeof exports==="object"){module.exports=joint}if(typeof exports==="object"){var joint={dia:{Link:require("./joint.dia.link").Link,Element:require("./joint.dia.element").Element},shapes:require("../plugins/shapes")};var Backbone=require("backbone");var _=require("lodash");var g=require("./geometry")}joint.dia.GraphCells=Backbone.Collection.extend({initialize:function(){this.on("change:z",this.sort,this)},model:function(e,t){if(e.type==="link"){return new joint.dia.Link(e,t)}var n=e.type.split(".")[0];var r=e.type.split(".")[1];if(joint.shapes[n]&&joint.shapes[n][r]){return new joint.shapes[n][r](e,t)}return new joint.dia.Element(e,t)},comparator:function(e){return e.get("z")||0},getConnectedLinks:function(e,t){t=t||{};if(__.isUndefined(t.inbound)&&__.isUndefined(t.outbound)){t.inbound=t.outbound=true}var n=[];this.each(function(r){var i=r.get("source");var s=r.get("target");if(i&&i.id===e.id&&t.outbound){n.push(r)}if(s&&s.id===e.id&&t.inbound){n.push(r)}});return n}});joint.dia.Graph=Backbone.Model.extend({initialize:function(){this.set("cells",new joint.dia.GraphCells);this.get("cells").on("all",this.trigger,this);this.get("cells").on("remove",this.removeCell,this)},toJSON:function(){var e=Backbone.Model.prototype.toJSON.apply(this,arguments);e.cells=this.get("cells").toJSON();return e},fromJSON:function(e,t){if(!e.cells){throw new Error("Graph JSON must contain cells array.")}this.set(__.omit(e,"cells"),t);this.resetCells(e.cells,t)},clear:function(e){this.trigger("batch:start");this.get("cells").remove(this.get("cells").models,e);this.trigger("batch:stop")},_prepareCell:function(e){if(e instanceof Backbone.Model&&__.isUndefined(e.get("z"))){e.set("z",this.maxZIndex()+1,{silent:true})}else if(__.isUndefined(e.z)){e.z=this.maxZIndex()+1}return e},maxZIndex:function(){var e=this.get("cells").last();return e?e.get("z")||0:0},addCell:function(e,t){if(__.isArray(e)){return this.addCells(e,t)}this.get("cells").add(this._prepareCell(e),t||{});return this},addCells:function(e,t){t=t||{};t.position=e.length;__.each(e,function(e){t.position--;this.addCell(e,t)},this);return this},resetCells:function(e,t){this.get("cells").reset(__.map(e,this._prepareCell,this),t);return this},removeCell:function(e,t,n){if(n&&n.disconnectLinks){this.disconnectLinks(e)}else{this.removeLinks(e)}this.get("cells").remove(e,{silent:true})},getCell:function(e){return this.get("cells").get(e)},getElements:function(){return this.get("cells").filter(function(e){return e instanceof joint.dia.Element})},getLinks:function(){return this.get("cells").filter(function(e){return e instanceof joint.dia.Link})},getConnectedLinks:function(e,t){return this.get("cells").getConnectedLinks(e,t)},getNeighbors:function(e){var t=this.getConnectedLinks(e);var n=[];var r=this.get("cells");__.each(t,function(t){var i=t.get("source");var s=t.get("target");if(!i.x){var o=r.get(i.id);if(o!==e){n.push(o)}}if(!s.x){var u=r.get(s.id);if(u!==e){n.push(u)}}});return n},disconnectLinks:function(e){__.each(this.getConnectedLinks(e),function(t){t.set(t.get("source").id===e.id?"source":"target",g.point(0,0))})},removeLinks:function(e){__.invoke(this.getConnectedLinks(e),"remove")},findModelsFromPoint:function(e){return __.filter(this.getElements(),function(t){return t.getBBox().containsPoint(e)})},findModelsInArea:function(e){return __.filter(this.getElements(),function(t){return t.getBBox().intersect(e)})},getBBox:function(e){var t={x:Infinity,y:Infinity};var n={x:0,y:0};__.each(e,function(e){var r=e.getBBox();t.x=Math.min(t.x,r.x);t.y=Math.min(t.y,r.y);n.x=Math.max(n.x,r.x+r.width);n.y=Math.max(n.y,r.y+r.height)});return g.rect(t.x,t.y,n.x-t.x,n.y-t.y)}});if(typeof exports==="object"){module.exports.Graph=joint.dia.Graph}if(typeof exports==="object"){var joint={util:require("./core").util,dia:{Link:require("./joint.dia.link").Link}};var Backbone=require("backbone");var _=require("lodash")}joint.dia.Cell=Backbone.Model.extend({constructor:function(e,t){var n;var r=e||{};this.cid=__.uniqueId("c");this.attributes={};if(t&&t.collection)this.collection=t.collection;if(t&&t.parse)r=this.parse(r,t)||{};if(n=__.result(this,"defaults")){r=__.merge({},n,r)}this.set(r,t);this.changed={};this.initialize.apply(this,arguments)},toJSON:function(){var e=this.constructor.prototype.defaults.attrs||{};var t=this.attributes.attrs;var n={};__.each(t,function(t,r){var i=e[r];__.each(t,function(e,t){if(__.isObject(e)&&!__.isArray(e)){__.each(e,function(e,s){if(!i||!i[t]||!__.isEqual(i[t][s],e)){n[r]=n[r]||{};(n[r][t]||(n[r][t]={}))[s]=e}})}else if(!i||!__.isEqual(i[t],e)){n[r]=n[r]||{};n[r][t]=e}})});var r=__.cloneDeep(__.omit(this.attributes,"attrs"));r.attrs=n;return r},initialize:function(e){if(!e||!e.id){this.set("id",joint.util.uuid(),{silent:true})}this._transitionIds={};this.processPorts();this.on("change:attrs",this.processPorts,this)},processPorts:function(){var e=this.ports;var t={};__.each(this.get("attrs"),function(e,n){if(e&&e.port){if(!__.isUndefined(e.port.id)){t[e.port.id]=e.port}else{t[e.port]={id:e.port}}}});var n={};__.each(e,function(e,r){if(!t[r])n[r]=true});if(this.collection&&!__.isEmpty(n)){var r=this.collection.getConnectedLinks(this,{inbound:true});__.each(r,function(e){if(n[e.get("target").port])e.remove()});var i=this.collection.getConnectedLinks(this,{outbound:true});__.each(i,function(e){if(n[e.get("source").port])e.remove()})}this.ports=t},remove:function(e){var t=this.collection;if(t){t.trigger("batch:start")}var n=this.get("parent");if(n){var r=this.collection&&this.collection.get(n);r.unembed(this)}__.invoke(this.getEmbeddedCells(),"remove",e);this.trigger("remove",this,this.collection,e);if(t){t.trigger("batch:stop")}return this},toFront:function(){if(this.collection){this.set("z",(this.collection.last().get("z")||0)+1)}return this},toBack:function(){if(this.collection){this.set("z",(this.collection.first().get("z")||0)-1)}return this},embed:function(e){if(this.get("parent")==e.id){throw new Error("Recursive embedding not allowed.")}else{this.trigger("batch:start");e.set("parent",this.id);this.set("embeds",__.uniq((this.get("embeds")||[]).concat([e.id])));this.trigger("batch:stop")}return this},unembed:function(e){this.trigger("batch:start");var t=e.id;e.unset("parent");this.set("embeds",__.without(this.get("embeds"),t));this.trigger("batch:stop");return this},getEmbeddedCells:function(){if(this.collection){return __.map(this.get("embeds")||[],function(e){return this.collection.get(e)},this)}return[]},clone:function(e){e=e||{};var t=Backbone.Model.prototype.clone.apply(this,arguments);t.set("id",joint.util.uuid(),{silent:true});t.set("embeds","");if(!e.deep)return t;var n=__.sortBy(this.getEmbeddedCells(),function(e){return e instanceof joint.dia.Element});var r=[t];var i={};__.each(n,function(e){var n=e.clone({deep:true});t.embed(n[0]);__.each(n,function(n){if(n instanceof joint.dia.Link){if(n.get("source").id==this.id){n.prop("source",{id:t.id})}if(n.get("target").id==this.id){n.prop("target",{id:t.id})}i[e.id]=n;return}r.push(n);var s=this.collection.getConnectedLinks(e,{inbound:true});__.each(s,function(e){var t=i[e.id]||e.clone();i[e.id]=t;t.prop("target",{id:n.id})});var o=this.collection.getConnectedLinks(e,{outbound:true});__.each(o,function(e){var t=i[e.id]||e.clone();i[e.id]=t;t.prop("source",{id:n.id})})},this)},this);r=r.concat(__.values(i));return r},prop:function(e,t,n){var r="/";if(__.isString(e)){if(typeof t!=="undefined"){var i=e;var s=i.split("/");var o=s[0];if(s.length==1){return this.set(o,t,n)}var u={};var a=u;var f=o;__.each(__.rest(s),function(e){a=a[f]=__.isFinite(Number(e))?[]:{};f=e});u=joint.util.setByPath(u,i,t,"/");var l=__.merge({},this.attributes,u);return this.set(o,l[o],n)}else{return joint.util.getByPath(this.attributes,e,r)}}return this.set(__.merge({},this.attributes,e),t)},attr:function(e,t,n){var r=this.get("attrs");var i="/";if(__.isString(e)){if(typeof t!="undefined"){var s={};joint.util.setByPath(s,e,t,i);return this.set("attrs",__.merge({},r,s),n)}else{return joint.util.getByPath(r,e,i)}}return this.set("attrs",__.merge({},r,e),t,n)},removeAttr:function(e,t){if(__.isArray(e)){__.each(e,function(e){this.removeAttr(e,t)},this);return this}var n=joint.util.unsetByPath(__.merge({},this.get("attrs")),e,"/");return this.set("attrs",n,__.extend({dirty:true},t))},transition:function(e,t,n,r){r=r||"/";var i={duration:100,delay:10,timingFunction:joint.util.timing.linear,valueFunction:joint.util.interpolate.number};n=__.extend(i,n);var s=0;var o;var u=__.bind(function(t){var r,i,a,f;s=s||t;t-=s;i=t/n.duration;if(i<1){this._transitionIds[e]=r=joint.util.nextFrame(u)}else{i=1;delete this._transitionIds[e]}a=o(n.timingFunction(i));n.transitionId=r;this.prop(e,a,n);if(!r)this.trigger("transition:end",this,e)},this);var a=__.bind(function(i){this.stopTransitions(e);o=n.valueFunction(joint.util.getByPath(this.attributes,e,r),t);this._transitionIds[e]=joint.util.nextFrame(i);this.trigger("transition:start",this,e)},this);return __.delay(a,n.delay,u)},getTransitions:function(){return __.keys(this._transitionIds)},stopTransitions:function(e,t){t=t||"/";var n=e&&e.split(t);__(this._transitionIds).keys().filter(n&&function(e){return __.isEqual(n,e.split(t).slice(0,n.length))}).each(function(e){joint.util.cancelFrame(this._transitionIds[e]);delete this._transitionIds[e];this.trigger("transition:end",this,e)},this);return this},addTo:function(e){e.addCell(this);return this},findView:function(e){return e.findViewByModel(this)}});joint.dia.CellView=Backbone.View.extend({tagName:"g",attributes:function(){return{"model-id":this.model.id}},constructor:function(e){this._configure(e);Backbone.View.apply(this,arguments)},_configure:function(e){if(this.options)e=__.extend({},__.result(this,"options"),e);this.options=e;this.options.id=this.options.id||joint.util.guid(this)},initialize:function(){__.bindAll(this,"remove","update");this.$el.data("view",this);this.listenTo(this.model,"remove",this.remove);this.listenTo(this.model,"change:attrs",this.onChangeAttrs)},onChangeAttrs:function(e,t,n){if(n.dirty){return this.render()}return this.update()},_ensureElement:function(){var e;if(!this.el){var t=__.extend({id:this.id},__.result(this,"attributes"));if(this.className)t["class"]=__.result(this,"className");e=V(__.result(this,"tagName"),t).node}else{e=__.result(this,"el")}this.setElement(e,false)},findBySelector:function(e){var t=e==="."?this.$el:this.$el.find(e);return t},notify:function(e){if(this.paper){var t=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[e].concat(t));this.paper.trigger.apply(this.paper,[e,this].concat(t))}},getStrokeBBox:function(e){var t=!!e;e=e||this.el;var n=V(e).bbox(false,this.paper.viewport);var r;if(t){r=V(e).attr("stroke-width")}else{r=this.model.attr("rect/stroke-width")||this.model.attr("circle/stroke-width")||this.model.attr("ellipse/stroke-width")||this.model.attr("path/stroke-width")}r=parseFloat(r)||0;return g.rect(n).moveAndExpand({x:-r/2,y:-r/2,width:r,height:r})},getBBox:function(){return V(this.el).bbox()},highlight:function(e){e=!e?this.el:this.$(e)[0]||this.el;V(e).addClass("highlighted")},unhighlight:function(e){e=!e?this.el:this.$(e)[0]||this.el;V(e).removeClass("highlighted")},findMagnet:function(e){var t=this.$(e);if(t.length===0||t[0]===this.el){var n=this.model.get("attrs")||{};if(n["."]&&n["."]["magnet"]===false){return undefined}return this.el}if(t.attr("magnet")){return t[0]}return this.findMagnet(t.parent())},applyFilter:function(e,t){var n=this.findBySelector(e);var r=t.name+this.paper.svg.id+joint.util.hashCode(JSON.stringify(t));if(!this.paper.svg.getElementById(r)){var i=joint.util.filter[t.name]&&joint.util.filter[t.name](t.args||{});if(!i){throw new Error("Non-existing filter "+t.name)}var s=V(i);s.attr({filterUnits:"objectBoundingBox",x:-1,y:-1,width:3,height:3});if(t.attrs)s.attr(t.attrs);s.node.id=r;V(this.paper.svg).defs().append(s)}n.each(function(){V(this).attr("filter","url(#"+r+")")})},applyGradient:function(e,t,n){var r=this.findBySelector(e);var i=n.type+this.paper.svg.id+joint.util.hashCode(JSON.stringify(n));if(!this.paper.svg.getElementById(i)){var s=["<"+n.type+">",__.map(n.stops,function(e){return'<stop offset="'+e.offset+'" stop-color="'+e.color+'" stop-opacity="'+(__.isFinite(e.opacity)?e.opacity:1)+'" />'}).join(""),"</"+n.type+">"].join("");var o=V(s);if(n.attrs){o.attr(n.attrs)}o.node.id=i;V(this.paper.svg).defs().append(o)}r.each(function(){V(this).attr(t,"url(#"+i+")")})},getSelector:function(e,t){if(e===this.el){return t}var n=$(e).index();t=e.tagName+":nth-child("+(n+1)+")"+" "+(t||"");return this.getSelector($(e).parent()[0],t+" ")},pointerdblclick:function(e,t,n){this.notify("cell:pointerdblclick",e,t,n)},pointerclick:function(e,t,n){this.notify("cell:pointerclick",e,t,n)},pointerdown:function(e,t,n){if(this.model.collection){this.model.trigger("batch:start");this._collection=this.model.collection}this.notify("cell:pointerdown",e,t,n)},pointermove:function(e,t,n){this.notify("cell:pointermove",e,t,n)},pointerup:function(e,t,n){this.notify("cell:pointerup",e,t,n);if(this._collection){this._collection.trigger("batch:stop");delete this._collection}}});if(typeof exports==="object"){module.exports.Cell=joint.dia.Cell;module.exports.CellView=joint.dia.CellView}if(typeof exports==="object"){var joint={util:require("./core").util,dia:{Cell:require("./joint.dia.cell").Cell,CellView:require("./joint.dia.cell").CellView}};var Backbone=require("backbone");var _=require("lodash")}joint.dia.Element=joint.dia.Cell.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},position:function(e,t){this.set("position",{x:e,y:t})},translate:function(e,t,n){t=t||0;if(e===0&&t===0){return this}var r=this.get("position")||{x:0,y:0};var i={x:r.x+e||0,y:r.y+t||0};if(n&&n.transition){if(!__.isObject(n.transition))n.transition={};this.transition("position",i,__.extend({},n.transition,{valueFunction:joint.util.interpolate.object}))}else{this.set("position",i,n);__.invoke(this.getEmbeddedCells(),"translate",e,t,n)}return this},resize:function(e,t){this.trigger("batch:start");this.set("size",{width:e,height:t});this.trigger("batch:stop");return this},rotate:function(e,t,n){if(n){var r=this.getBBox().center();var i=this.get("size");var s=this.get("position");r.rotate(n,(this.get("angle")||0)-e);var o=r.x-i.width/2-s.x;var u=r.y-i.height/2-s.y;this.trigger("batch:start");this.translate(o,u);this.rotate(e,t);this.trigger("batch:stop")}else{this.set("angle",t?e:((this.get("angle")||0)+e)%360)}return this},getBBox:function(){var e=this.get("position");var t=this.get("size");return g.rect(e.x,e.y,t.width,t.height)}});joint.dia.ElementView=joint.dia.CellView.extend({className:function(){return"element "+this.model.get("type").split(".").join(" ")},initialize:function(){__.bindAll(this,"translate","resize","rotate");joint.dia.CellView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:position",this.translate);this.listenTo(this.model,"change:size",this.resize);this.listenTo(this.model,"change:angle",this.rotate)},update:function(e,t){var n=this.model.get("attrs");var r=V(this.$(".rotatable")[0]);if(r){var i=r.attr("transform");r.attr("transform","")}var s=[];__.each(t||n,function(e,t){var n=this.findBySelector(t);if(n.length===0)return;var r=["style","text","html","ref-x","ref-y","ref-dx","ref-dy","ref-width","ref-height","ref","x-alignment","y-alignment","port"];if(__.isObject(e.filter)){r.push("filter");this.applyFilter(t,e.filter)}if(__.isObject(e.fill)){r.push("fill");this.applyGradient(t,"fill",e.fill)}if(__.isObject(e.stroke)){r.push("stroke");this.applyGradient(t,"stroke",e.stroke)}if(!__.isUndefined(e.text)){n.each(function(){V(this).text(e.text+"",{lineHeight:e.lineHeight})})}var i=__.omit(e,r);n.each(function(){V(this).attr(i)});if(e.port){n.attr("port",__.isUndefined(e.port.id)?e.port:e.port.id)}if(e.style){n.css(e.style)}if(!__.isUndefined(e.html)){n.each(function(){$(this).html(e.html+"")})}if(!__.isUndefined(e["ref-x"])||!__.isUndefined(e["ref-y"])||!__.isUndefined(e["ref-dx"])||!__.isUndefined(e["ref-dy"])||!__.isUndefined(e["x-alignment"])||!__.isUndefined(e["y-alignment"])||!__.isUndefined(e["ref-width"])||!__.isUndefined(e["ref-height"])){__.each(n,function(e,t,n){var r=$(e);r.selector=n.selector;s.push(r)})}},this);var o=this.el.getBBox();t=t||{};__.each(s,function(e){var r=t[e.selector];var i=r?__.merge({},n[e.selector],r):n[e.selector];this.positionRelative(e,o,i)},this);if(r){r.attr("transform",i||"")}},positionRelative:function(e,t,n){function d(e){return __.isNumber(e)&&!__.isNaN(e)}var r=n["ref"];var i=parseFloat(n["ref-x"]);var s=parseFloat(n["ref-y"]);var o=parseFloat(n["ref-dx"]);var u=parseFloat(n["ref-dy"]);var a=n["y-alignment"];var f=n["x-alignment"];var l=parseFloat(n["ref-width"]);var c=parseFloat(n["ref-height"]);var h=__.contains(__.pluck(__.pluck(e.parents("g"),"className"),"baseVal"),"scalable");if(r){t=V(this.findBySelector(r)[0]).bbox(false,this.el)}var p=V(e[0]);if(p.attr("transform")){p.attr("transform",p.attr("transform").replace(/translate\([^)]*\)/g,"").trim()||"")}var v=0;var m=0;if(d(l)){if(l>=0&&l<=1){p.attr("width",l*t.width)}else{p.attr("width",Math.max(l+t.width,0))}}if(d(c)){if(c>=0&&c<=1){p.attr("height",c*t.height)}else{p.attr("height",Math.max(c+t.height,0))}}if(d(o)){if(h){var g=V(this.$(".scalable")[0]).scale();v=t.x+t.width+o/g.sx}else{v=t.x+t.width+o}}if(d(u)){if(h){var g=V(this.$(".scalable")[0]).scale();m=t.y+t.height+u/g.sy}else{m=t.y+t.height+u}}if(d(i)){if(i>0&&i<1){v=t.x+t.width*i}else if(h){var g=V(this.$(".scalable")[0]).scale();v=t.x+i/g.sx}else{v=t.x+i}}if(d(s)){if(s>0&&s<1){m=t.y+t.height*s}else if(h){var g=V(this.$(".scalable")[0]).scale();m=t.y+s/g.sy}else{m=t.y+s}}var y=p.bbox(false,this.paper.viewport);if(a==="middle"){m-=y.height/2}else if(d(a)){m+=a>-1&&a<1?y.height*a:a}if(f==="middle"){v-=y.width/2}else if(d(f)){v+=f>-1&&f<1?y.width*f:f}p.translate(v,m)},renderMarkup:function(){var e=this.model.markup||this.model.get("markup");if(e){var t=V(e);V(this.el).append(t)}else{throw new Error("properties.markup is missing while the default render() implementation is used.")}},render:function(){this.$el.empty();this.renderMarkup();this.update();this.resize();this.rotate();this.translate();return this},scale:function(e,t){V(this.el).scale(e,t)},resize:function(){var e=this.model.get("size")||{width:1,height:1};var t=this.model.get("angle")||0;var n=V(this.$(".scalable")[0]);if(!n){return}var r=n.bbox(true);n.attr("transform","scale("+e.width/(r.width||1)+","+e.height/(r.height||1)+")");var i=V(this.$(".rotatable")[0]);var s=i&&i.attr("transform");if(s&&s!=="null"){i.attr("transform",s+" rotate("+ -t+","+e.width/2+","+e.height/2+")");var o=n.bbox(false,this.paper.viewport);this.model.set("position",{x:o.x,y:o.y});this.rotate()}this.update()},translate:function(e,t,n){var r=this.model.get("position")||{x:0,y:0};V(this.el).attr("transform","translate("+r.x+","+r.y+")")},rotate:function(){var e=V(this.$(".rotatable")[0]);if(!e){return}var t=this.model.get("angle")||0;var n=this.model.get("size")||{width:1,height:1};var r=n.width/2;var i=n.height/2;e.attr("transform","rotate("+t+","+r+","+i+")")},pointerdown:function(e,t,n){if(e.target.getAttribute("magnet")&&this.paper.options.validateMagnet.call(this.paper,this,e.target)){this.model.trigger("batch:start");var r=this.paper.getDefaultLink(this,e.target);r.set({source:{id:this.model.id,selector:this.getSelector(e.target),port:$(e.target).attr("port")},target:{x:t,y:n}});this.paper.model.addCell(r);this._linkView=this.paper.findViewByModel(r);this._linkView.startArrowheadMove("target")}else{this._dx=t;this._dy=n;joint.dia.CellView.prototype.pointerdown.apply(this,arguments)}},pointermove:function(e,t,n){if(this._linkView){this._linkView.pointermove(e,t,n)}else{var r=this.paper.options.gridSize;var i=__.isFunction(this.options.interactive)?this.options.interactive(this,"pointermove"):this.options.interactive;if(i!==false){var s=this.model.get("position");this.model.translate(g.snapToGrid(s.x,r)-s.x+g.snapToGrid(t-this._dx,r),g.snapToGrid(s.y,r)-s.y+g.snapToGrid(n-this._dy,r))}this._dx=g.snapToGrid(t,r);this._dy=g.snapToGrid(n,r);joint.dia.CellView.prototype.pointermove.apply(this,arguments)}},pointerup:function(e,t,n){if(this._linkView){this._linkView.pointerup(e,t,n);delete this._linkView;this.model.trigger("batch:stop")}else{joint.dia.CellView.prototype.pointerup.apply(this,arguments)}}});if(typeof exports==="object"){module.exports.Element=joint.dia.Element;module.exports.ElementView=joint.dia.ElementView}if(typeof exports==="object"){var joint={dia:{Cell:require("./joint.dia.cell").Cell,CellView:require("./joint.dia.cell").CellView}};var Backbone=require("backbone");var _=require("lodash");var g=require("./geometry")}joint.dia.Link=joint.dia.Cell.extend({markup:['<path class="connection" stroke="black"/>','<path class="marker-source" fill="black" stroke="black" />','<path class="marker-target" fill="black" stroke="black" />','<path class="connection-wrap"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),labelMarkup:['<g class="label">',"<rect />","<text />","</g>"].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z"/>',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaults:{type:"link"},disconnect:function(){return this.set({source:g.point(0,0),target:g.point(0,0)})},label:function(e,t){e=e||0;var n=this.get("labels")||[];if(arguments.length===0||arguments.length===1){return n[e]}var r=__.merge({},n[e],t);var i=n.slice();i[e]=r;return this.set({labels:i})},translate:function(e,t,n){var r={};var i=this.get("source");var s=this.get("target");var o=this.get("vertices");if(!i.id){r.source={x:i.x+e,y:i.y+t}}if(!s.id){r.target={x:s.x+e,y:s.y+t}}if(o&&o.length){r.vertices=__.map(o,function(n){return{x:n.x+e,y:n.y+t}})}return this.set(r,n)}});joint.dia.LinkView=joint.dia.CellView.extend({className:function(){return __.unique(this.model.get("type").split(".").concat("link")).join(" ")},options:{shortLinkLength:100},initialize:function(){joint.dia.CellView.prototype.initialize.apply(this,arguments);if(typeof this.constructor.prototype.watchSource!=="function"){this.constructor.prototype.watchSource=this._createWatcher("source");this.constructor.prototype.watchTarget=this._createWatcher("target")}this._labelCache={};this._markerCache={};this.startListening()},startListening:function(){this.listenTo(this.model,"change:markup",this.render);this.listenTo(this.model,"change:smooth change:manhattan change:router change:connector",this.update);this.listenTo(this.model,"change:toolMarkup",function(){this.renderTools().updateToolsPosition()});this.listenTo(this.model,"change:labels change:labelMarkup",function(){this.renderLabels().updateLabelPositions()});this.listenTo(this.model,"change:vertices change:vertexMarkup",function(){this.renderVertexMarkers().update()});this.listenTo(this.model,"change:source",function(e,t){this.watchSource(e,t).update()});this.listenTo(this.model,"change:target",function(e,t){this.watchTarget(e,t).update()})},render:function(){this.$el.empty();var e=V(this.model.get("markup")||this.model.markup);if(!__.isArray(e))e=[e];this._V={};__.each(e,function(e){var t=e.attr("class");t&&(this._V[$.camelCase(t)]=e)},this);if(!this._V.connection)throw new Error("link: no connection path in the markup");this.renderTools();this.renderVertexMarkers();this.renderArrowheadMarkers();V(this.el).append(e);this.renderLabels();this.watchSource(this.model,this.model.get("source")).watchTarget(this.model,this.model.get("target")).update();return this},renderLabels:function(){if(!this._V.labels)return this;this._labelCache={};var e=$(this._V.labels.node).empty();var t=this.model.get("labels")||[];if(!t.length)return this;var n=__.template(this.model.get("labelMarkup")||this.model.labelMarkup);var r=V(n());__.each(t,function(t,n){var i=r.clone().node;this._labelCache[n]=V(i);var s=$(i).find("text");var o=$(i).find("rect");var u=__.extend({"text-anchor":"middle","font-size":14},joint.util.getByPath(t,"attrs/text","/"));s.attr(__.omit(u,"text"));if(!__.isUndefined(u.text)){V(s[0]).text(u.text+"")}e.append(i);var a=V(s[0]).bbox(true,e[0]);V(s[0]).translate(0,-a.height/2);var f=__.extend({fill:"white",rx:3,ry:3},joint.util.getByPath(t,"attrs/rect","/"));o.attr(__.extend(f,{x:a.x,y:a.y-a.height/2,width:a.width,height:a.height}))},this);return this},renderTools:function(){if(!this._V.linkTools)return this;var e=$(this._V.linkTools.node).empty();var t=__.template(this.model.get("toolMarkup")||this.model.toolMarkup);var n=V(t());e.append(n.node);this._toolCache=n;return this},renderVertexMarkers:function(){if(!this._V.markerVertices)return this;var e=$(this._V.markerVertices.node).empty();var t=__.template(this.model.get("vertexMarkup")||this.model.vertexMarkup);__.each(this.model.get("vertices"),function(n,r){e.append(V(t(__.extend({idx:r},n))).node)});return this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;var e=$(this._V.markerArrowheads.node);e.empty();var t=__.template(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);this._V.sourceArrowhead=V(t({end:"source"}));this._V.targetArrowhead=V(t({end:"target"}));e.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node);return this},update:function(){__.each(this.model.get("attrs"),function(e,t){if(__.isObject(e.filter)){this.findBySelector(t).attr(__.omit(e,"filter"));this.applyFilter(t,e.filter)}else{this.findBySelector(t).attr(e)}},this);var e=this.route=this.findRoute(this.model.get("vertices")||[]);this._findConnectionPoints(e);var t=this.getPathData(e);this._V.connection.attr("d",t);this._V.connectionWrap&&this._V.connectionWrap.attr("d",t);this._translateAndAutoOrientArrows(this._V.markerSource,this._V.markerTarget);this.updateLabelPositions();this.updateToolsPosition();this.updateArrowheadMarkers();delete this.options.perpendicular;return this},_findConnectionPoints:function(e){var t,n,r,i;var s=__.first(e);t=this.getConnectionPoint("source",this.model.get("source"),s||this.model.get("target")).round();var o=__.last(e);n=this.getConnectionPoint("target",this.model.get("target"),o||t).round();var u=this._markerCache;if(this._V.markerSource){u.sourceBBox=u.sourceBBox||this._V.markerSource.bbox(true);r=g.point(t).move(s||n,u.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()}if(this._V.markerTarget){u.targetBBox=u.targetBBox||this._V.markerTarget.bbox(true);i=g.point(n).move(o||t,u.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()}u.sourcePoint=r||t;u.targetPoint=i||n;this.sourcePoint=t;this.targetPoint=n},updateLabelPositions:function(){if(!this._V.labels)return this;var e=this.model.get("labels")||[];if(!e.length)return this;var t=this._V.connection.node;var n=t.getTotalLength();if(!__.isNaN(n)){__.each(e,function(e,r){var i=e.position;i=i>n?n:i;i=i<0?n+i:i;i=i>1?i:n*i;var s=t.getPointAtLength(i);this._labelCache[r].attr("transform","translate("+s.x+", "+s.y+")")},this)}return this},updateToolsPosition:function(){if(!this._V.linkTools)return this;var e="";var t=40;if(this.getConnectionLength()<this.options.shortLinkLength){e="scale(.5)";t/=2}var n=this.getPointAtLength(t);this._toolCache.attr("transform","translate("+n.x+", "+n.y+") "+e);return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;if($.css(this._V.markerArrowheads.node,"display")==="none")return this;var e=this.getConnectionLength()<this.options.shortLinkLength?.5:1;this._V.sourceArrowhead.scale(e);this._V.targetArrowhead.scale(e);this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead);return this},_createWatcher:function(e){function t(t,n){n=n||{};var r=t.previous(e)||{};var i=this["_"+e+"BBoxUpdate"];if(this._isModel(r)){this.stopListening(this.paper.getModelById(r.id),"change",i)}if(this._isModel(n)){this.listenTo(this.paper.getModelById(n.id),"change",i)}__.bind(i,this)({cacheOnly:true});return this}return t},_sourceBBoxUpdate:function(e){this.lastEndChange="source";e=e||{};var t=this.model.get("source");if(this._isModel(t)){var n=this._makeSelector(t);var r=this.paper.findViewByModel(t.id);var i=this.paper.viewport.querySelector(n);this.sourceBBox=r.getStrokeBBox(i);this.sourceView=r;this.sourceMagnet=i}else if(t){this.sourceBBox=g.rect(t.x,t.y,1,1)}if(!e.cacheOnly)this.update()},_targetBBoxUpdate:function(e){this.lastEndChange="target";e=e||{};var t=this.model.get("target");if(this._isModel(t)){var n=this._makeSelector(t);var r=this.paper.findViewByModel(t.id);var i=this.paper.viewport.querySelector(n);this.targetBBox=r.getStrokeBBox(i);this.targetView=r;this.targetMagnet=i}else if(t){this.targetBBox=g.rect(t.x,t.y,1,1)}if(!e.cacheOnly)this.update()},_translateAndAutoOrientArrows:function(e,t){if(e){e.translateAndAutoOrient(this.sourcePoint,__.first(this.route)||this.targetPoint,this.paper.viewport)}if(t){t.translateAndAutoOrient(this.targetPoint,__.last(this.route)||this.sourcePoint,this.paper.viewport)}},removeVertex:function(e){var t=__.clone(this.model.get("vertices"));if(t&&t.length){t.splice(e,1);this.model.set("vertices",t)}return this},addVertex:function(e){this.model.set("attrs",this.model.get("attrs")||{});var t=this.model.get("attrs");var n=(this.model.get("vertices")||[]).slice();var r=n.slice();var i=this._V.connection.node.cloneNode(false);var s=i.getTotalLength();var o;var u=20;var a=n.length+1;while(a--){n.splice(a,0,e);V(i).attr("d",this.getPathData(this.findRoute(n)));o=i.getTotalLength();if(o-s>u){n=r.slice()}else{break}}if(a===-1){a=0;n.splice(a,0,e)}this.model.set("vertices",n);return a},sendToken:function(e,t,n){t=t||1e3;V(this.paper.viewport).append(e);V(e).animateAlongPath({dur:t+"ms",repeatCount:1},this._V.connection.node);__.delay(function(){V(e).remove();n&&n()},t)},findRoute:function(e){var t=this.model.get("router");if(!t){if(this.model.get("manhattan")){t={name:"orthogonal"}}else{return e}}var n=joint.routers[t.name];if(!__.isFunction(n)){throw"unknown router: "+t.name}var r=n.call(this,e||[],t.args||{},this);return r},getPathData:function(e){var t=this.model.get("connector");if(!t){t=this.model.get("smooth")?{name:"smooth"}:{name:"normal"}}if(!__.isFunction(joint.connectors[t.name])){throw"unknown connector: "+t.name}var n=joint.connectors[t.name].call(this,this._markerCache.sourcePoint,this._markerCache.targetPoint,e||this.model.get("vertices")||{},t.args||{},this);return n},getConnectionPoint:function(e,t,n){var r;t=t||{x:0,y:0};n=n||{x:0,y:0};if(this._isPoint(t)){r=g.point(t)}else{var i=e==="source"?this.sourceBBox:this.targetBBox;var s;if(this._isPoint(n)){s=g.point(n)}else{var o=e==="source"?this.targetBBox:this.sourceBBox;s=g.rect(o).intersectionWithLineFromCenterToPoint(g.rect(i).center());s=s||g.rect(o).center()}if(this.paper.options.perpendicularLinks||this.options.perpendicular){var u=g.rect(0,s.y,this.paper.options.width,1);var a=g.rect(s.x,0,1,this.paper.options.height);var f;if(u.intersect(g.rect(i))){f=g.rect(i).sideNearestToPoint(s);switch(f){case"left":r=g.point(i.x,s.y);break;case"right":r=g.point(i.x+i.width,s.y);break;default:r=g.rect(i).center();break}}else if(a.intersect(g.rect(i))){f=g.rect(i).sideNearestToPoint(s);switch(f){case"top":r=g.point(s.x,i.y);break;case"bottom":r=g.point(s.x,i.y+i.height);break;default:r=g.rect(i).center();break}}else{r=g.rect(i).intersectionWithLineFromCenterToPoint(s);r=r||g.rect(i).center()}}else if(this.paper.options.linkConnectionPoint){var l=e==="target"?this.targetView:this.sourceView;var c=e==="target"?this.targetMagnet:this.sourceMagnet;r=this.paper.options.linkConnectionPoint(this,l,c,s)}else{r=g.rect(i).intersectionWithLineFromCenterToPoint(s);r=r||g.rect(i).center()}}return r},_isModel:function(e){return e&&e.id},_isPoint:function(e){return!this._isModel(e)},_makeSelector:function(e){var t='[model-id="'+e.id+'"]';if(e.port){t+=' [port="'+e.port+'"]'}else if(e.selector){t+=" "+e.selector}return t},getConnectionLength:function(){return this._V.connection.node.getTotalLength()},getPointAtLength:function(e){return this._V.connection.node.getPointAtLength(e)},_beforeArrowheadMove:function(){this.model.trigger("batch:start");this._z=this.model.get("z");this.model.set("z",Number.MAX_VALUE);this.el.style.pointerEvents="none";if(this.paper.options.markAvailable){this._markAvailableMagnets()}},_afterArrowheadMove:function(){if(this._z){this.model.set("z",this._z);delete this._z}this.el.style.pointerEvents="visiblePainted";if(this.paper.options.markAvailable){this._unmarkAvailableMagnets()}this.model.trigger("batch:stop")},_createValidateConnectionArgs:function(e){function o(e,n){t[i]=e;t[i+1]=e.el===n?undefined:n;return t}var t=[];t[4]=e;t[5]=this;var n,r=0,i=0;if(e==="source"){r=2;n="target"}else{i=2;n="source"}var s=this.model.get(n);if(s.id){t[r]=this.paper.findViewByModel(s.id);t[r+1]=s.selector&&t[r].el.querySelector(s.selector)}return o},_markAvailableMagnets:function(){var e=this.paper.model.getElements();var t=this.paper.options.validateConnection;__.chain(e).map(this.paper.findViewByModel,this.paper).each(function(e){var n=e.el.getAttribute("magnet")!=="false"&&t.apply(this.paper,this._validateConnectionArgs(e,null));var r=__.filter(e.el.querySelectorAll("[magnet]"),function(n){return t.apply(this.paper,this._validateConnectionArgs(e,n))},this);if(n){V(e.el).addClass("available-magnet")}__.each(r,function(e){V(e).addClass("available-magnet")});if(n||r.length){V(e.el).addClass("available-cell")}},this)},_unmarkAvailableMagnets:function(){__.each(this.paper.el.querySelectorAll(".available-cell, .available-magnet"),function(e){V(e).removeClass("available-magnet").removeClass("available-cell")})},startArrowheadMove:function(e){this._action="arrowhead-move";this._arrowhead=e;this._validateConnectionArgs=this._createValidateConnectionArgs(this._arrowhead);this._beforeArrowheadMove()},pointerdown:function(e,t,n){function i(e){if(!__.isObject(r)||r[e]!==false)return true;return false}joint.dia.CellView.prototype.pointerdown.apply(this,arguments);this._dx=t;this._dy=n;var r=__.isFunction(this.options.interactive)?this.options.interactive(this,"pointerdown"):this.options.interactive;if(r===false)return;var s=e.target.getAttribute("class");switch(s){case"marker-vertex":if(i("vertexMove")){this._action="vertex-move";this._vertexIdx=e.target.getAttribute("idx")}break;case"marker-vertex-remove":case"marker-vertex-remove-area":if(i("vertexRemove")){this.removeVertex(e.target.getAttribute("idx"))}break;case"marker-arrowhead":if(i("arrowheadMove")){this.startArrowheadMove(e.target.getAttribute("end"))}break;default:var o=e.target.parentNode.getAttribute("event");if(o){if(o==="remove"){this.model.remove()}else{this.paper.trigger(o,e,this,t,n)}}else{if(i("vertexAdd")){this._vertexIdx=this.addVertex({x:t,y:n});this._action="vertex-move"}}}this.paper.trigger("link:pointerdown",e,this,t,n)},pointermove:function(e,t,n){joint.dia.CellView.prototype.pointermove.apply(this,arguments);switch(this._action){case"vertex-move":var r=__.clone(this.model.get("vertices"));r[this._vertexIdx]={x:t,y:n};this.model.set("vertices",r);break;case"arrowhead-move":if(this.paper.options.snapLinks){var i=this.paper.options.snapLinks.radius||50;var s=this.paper.findViewsInArea({x:t-i,y:n-i,width:2*i,height:2*i});this._closestView&&this._closestView.unhighlight(this._closestEnd.selector);this._closestView=this._closestEnd=null;var o=g.point(t,n);var u,a=Number.MAX_VALUE;__.each(s,function(e){if(e.el.getAttribute("magnet")!=="false"){u=e.model.getBBox().center().distance(o);if(u<i&&u<a){if(this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(e,null))){a=u;this._closestView=e;this._closestEnd={id:e.model.id}}}}e.$("[magnet]").each(__.bind(function(t,n){var r=V(n).bbox(false,this.paper.viewport);u=o.distance({x:r.x+r.width/2,y:r.y+r.height/2});if(u<i&&u<a){if(this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(e,n))){a=u;this._closestView=e;this._closestEnd={id:e.model.id,selector:e.getSelector(n),port:n.getAttribute("port")}}}},this))},this);this._closestView&&this._closestView.highlight(this._closestEnd.selector);this.model.set(this._arrowhead,this._closestEnd||{x:t,y:n})}else{var f=e.type==="mousemove"?e.target:document.elementFromPoint(e.clientX,e.clientY);if(this._targetEvent!==f){this._magnetUnderPointer&&this._viewUnderPointer.unhighlight(this._magnetUnderPointer);this._viewUnderPointer=this.paper.findView(f);if(this._viewUnderPointer){this._magnetUnderPointer=this._viewUnderPointer.findMagnet(f);if(this._magnetUnderPointer&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(this._viewUnderPointer,this._magnetUnderPointer))){this._magnetUnderPointer&&this._viewUnderPointer.highlight(this._magnetUnderPointer)}else{this._magnetUnderPointer=null}}else{this._magnetUnderPointer=null}}this._targetEvent=f;this.model.set(this._arrowhead,{x:t,y:n})}break}this._dx=t;this._dy=n},pointerup:function(e){joint.dia.CellView.prototype.pointerup.apply(this,arguments);if(this._action==="arrowhead-move"){if(this.paper.options.snapLinks){this._closestView&&this._closestView.unhighlight(this._closestEnd.selector);this._closestView=this._closestEnd=null}else{if(this._magnetUnderPointer){this._viewUnderPointer.unhighlight(this._magnetUnderPointer);this.model.set(this._arrowhead,{id:this._viewUnderPointer.model.id,selector:this._viewUnderPointer.getSelector(this._magnetUnderPointer),port:$(this._magnetUnderPointer).attr("port")})}delete this._viewUnderPointer;delete this._magnetUnderPointer;delete this._staticView;delete this._staticMagnet}this._afterArrowheadMove()}delete this._action}});if(typeof exports==="object"){module.exports.Link=joint.dia.Link;module.exports.LinkView=joint.dia.LinkView}joint.dia.Paper=Backbone.View.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:50,perpendicularLinks:false,elementView:joint.dia.ElementView,linkView:joint.dia.LinkView,snapLinks:false,markAvailable:false,defaultLink:new joint.dia.Link,validateMagnet:function(e,t){return t.getAttribute("magnet")!=="passive"},validateConnection:function(e,t,n,r,i,s){return(i==="target"?n:e)instanceof joint.dia.ElementView}},events:{mousedown:"pointerdown",dblclick:"mousedblclick",click:"mouseclick",touchstart:"pointerdown",mousemove:"pointermove",touchmove:"pointermove"},constructor:function(e){this._configure(e);Backbone.View.apply(this,arguments)},_configure:function(e){if(this.options)e=__.extend({},__.result(this,"options"),e);this.options=e},initialize:function(){__.bindAll(this,"addCell","sortCells","resetCells","pointerup","asyncRenderCells");this.svg=V("svg").node;this.viewport=V("g").node;V(this.svg).append(V("defs").node);V(this.viewport).attr({"class":"viewport"});V(this.svg).append(this.viewport);this.$el.append(this.svg);this.setOrigin();this.setDimensions();this.listenTo(this.model,"add",this.onAddCell);this.listenTo(this.model,"reset",this.resetCells);this.listenTo(this.model,"sort",this.sortCells);$(document).on("mouseup touchend",this.pointerup);this._mousemoved=false},remove:function(){$(document).off("mouseup touchend",this.pointerup);Backbone.View.prototype.remove.call(this)},setDimensions:function(e,t){e=this.options.width=e||this.options.width;t=this.options.height=t||this.options.height;V(this.svg).attr({width:e,height:t});this.trigger("resize",e,t)},setOrigin:function(e,t){this.options.origin.x=e||0;this.options.origin.y=t||0;V(this.viewport).translate(e,t,{absolute:true});this.trigger("translate",e,t)},fitToContent:function(e,t,n,r){if(__.isObject(e)){r=e;e=r.gridWidth||1;t=r.gridHeight||1;n=r.padding||0}else{r=r||{};e=e||1;t=t||1;n=n||0}var i=V(this.viewport).bbox(true,this.svg);var s=V(this.viewport).scale();i.x*=s.sx;i.y*=s.sy;i.width*=s.sx;i.height*=s.sy;var o=Math.max(Math.ceil((i.width+i.x)/e),1)*e;var u=Math.max(Math.ceil((i.height+i.y)/t),1)*t;var a=0;var f=0;if(r.allowNewOrigin=="negative"&&i.x<0||r.allowNewOrigin=="positive"&&i.x>=0||r.allowNewOrigin=="any"){a=Math.ceil(-i.x/e)*e;a+=n;o+=a}if(r.allowNewOrigin=="negative"&&i.y<0||r.allowNewOrigin=="positive"&&i.y>=0||r.allowNewOrigin=="any"){f=Math.ceil(-i.y/t)*t;f+=n;u+=f}o+=n;u+=n;var l=o!=this.options.width||u!=this.options.height;var c=a!=this.options.origin.x||f!=this.options.origin.y;if(c){this.setOrigin(a,f)}if(l){this.setDimensions(o,u)}},scaleContentToFit:function(e){var t=this.getContentBBox();if(!t.width||!t.height)return;e=e||{};__.defaults(e,{padding:0,preserveAspectRatio:true,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE});var n=e.padding;var r=e.minScaleX||e.minScale;var i=e.maxScaleX||e.maxScale;var s=e.minScaleY||e.minScale;var o=e.maxScaleY||e.maxScale;var u=e.fittingBBox||{x:this.options.origin.x,y:this.options.origin.y,width:this.options.width,height:this.options.height};u=g.rect(u).moveAndExpand({x:n,y:n,width:-2*n,height:-2*n});var a=V(this.viewport).scale();var f=u.width/t.width*a.sx;var l=u.height/t.height*a.sy;if(e.preserveAspectRatio){f=l=Math.min(f,l)}if(e.scaleGrid){var c=e.scaleGrid;f=c*Math.floor(f/c);l=c*Math.floor(l/c)}f=Math.min(i,Math.max(r,f));l=Math.min(o,Math.max(s,l));this.scale(f,l);var h=this.getContentBBox();var p=u.x-h.x;var d=u.y-h.y;this.setOrigin(p,d)},getContentBBox:function(){var e=this.viewport.getBoundingClientRect();var t=this.viewport.getScreenCTM();var n=this.viewport.getCTM();var r=g.rect({x:e.left-t.e+n.e,y:e.top-t.f+n.f,width:e.width,height:e.height});return r},createViewForModel:function(e){var t;var n=e.get("type");var r=n.split(".")[0];var i=n.split(".")[1];if(joint.shapes[r]&&joint.shapes[r][i+"View"]){t=new joint.shapes[r][i+"View"]({model:e,interactive:this.options.interactive})}else if(e instanceof joint.dia.Element){t=new this.options.elementView({model:e,interactive:this.options.interactive})}else{t=new this.options.linkView({model:e,interactive:this.options.interactive})}return t},onAddCell:function(e,t,n){if(this.options.async&&n.async!==false&&__.isNumber(n.position)){this._asyncCells=this._asyncCells||[];this._asyncCells.push(e);if(n.position==0){if(this._frameId)throw"another asynchronous rendering in progress";this.asyncRenderCells(this._asyncCells);delete this._asyncCells}}else{this.addCell(e)}},addCell:function(e){var t=this.createViewForModel(e);V(this.viewport).append(t.el);t.paper=this;t.render();$(t.el).find("image").on("dragstart",function(){return false})},resetCells:function(e){$(this.viewport).empty();var t=e.models.slice();t.sort(function(e,t){return e instanceof joint.dia.Link?1:-1});if(this._frameId){joint.util.cancelFrame(this._frameId);delete this._frameId}if(this.options.async){this.asyncRenderCells(t)}else{__.each(t,this.addCell,this);this.sortCells()}},asyncRenderCells:function(e){var t=false;if(this._frameId){__.each(__.range(this.options.async&&this.options.async.batchSize||50),function(){var n=e.shift();t=!n;if(!t)this.addCell(n)},this)}if(t){delete this._frameId;this.sortCells();this.trigger("render:done")}else{this._frameId=joint.util.nextFrame(__.bind(function(){this.asyncRenderCells(e)},this))}},sortCells:function(){var e=$(this.viewport).children("[model-id]");var t=this.model.get("cells");this.sortElements(e,function(e,n){var r=t.get($(e).attr("model-id"));var i=t.get($(n).attr("model-id"));return(r.get("z")||0)>(i.get("z")||0)?1:-1})},sortElements:function(e,t){var n=$(e);var r=n.map(function(){var e=this;var t=e.parentNode;var n=t.insertBefore(document.createTextNode(""),e.nextSibling);return function(){if(t===this){throw new Error("You can't sort elements if any one is a descendant of another.")}t.insertBefore(this,n);t.removeChild(n)}});return Array.prototype.sort.call(n,t).each(function(e){r[e].call(this)})},scale:function(e,t,n,r){t=t||e;if(__.isUndefined(n)){n=0;r=0}V(this.viewport).attr("transform","");var i=this.options.origin.x;var s=this.options.origin.y;if(n||r||i||s){var o=i-n*(e-1);var u=s-r*(t-1);this.setOrigin(o,u)}V(this.viewport).scale(e,t);this.trigger("scale",e,t,n,r);return this},rotate:function(e,t,n){if(__.isUndefined(t)){var r=this.viewport.getBBox();t=r.width/2;n=r.height/2}V(this.viewport).rotate(e,t,n)},findView:function(e){var t=this.$(e);if(t.length===0||t[0]===this.el){return undefined}if(t.data("view")){return t.data("view")}return this.findView(t.parent())},findViewByModel:function(e){var t=__.isString(e)?e:e.id;var n=this.$('[model-id="'+t+'"]');if(n.length){return n.data("view")}return undefined},findViewsFromPoint:function(e){e=g.point(e);var t=__.map(this.model.getElements(),this.findViewByModel);return __.filter(t,function(t){return g.rect(V(t.el).bbox(false,this.viewport)).containsPoint(e)},this)},findViewsInArea:function(e){e=g.rect(e);var t=__.map(this.model.getElements(),this.findViewByModel);return __.filter(t,function(t){return e.intersect(g.rect(V(t.el).bbox(false,this.viewport)))},this)},getModelById:function(e){return this.model.getCell(e)},snapToGrid:function(e){var t=V(this.viewport).toLocalPoint(e.x,e.y);return{x:g.snapToGrid(t.x,this.options.gridSize),y:g.snapToGrid(t.y,this.options.gridSize)}},getDefaultLink:function(e,t){return __.isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,e,t):this.options.defaultLink.clone()},mousedblclick:function(e){e.preventDefault();e=joint.util.normalizeEvent(e);var t=this.findView(e.target);var n=this.snapToGrid({x:e.clientX,y:e.clientY});if(t){t.pointerdblclick(e,n.x,n.y)}else{this.trigger("blank:pointerdblclick",e,n.x,n.y)}},mouseclick:function(e){if(!this._mousemoved){e=joint.util.normalizeEvent(e);var t=this.findView(e.target);var n=this.snapToGrid({x:e.clientX,y:e.clientY});if(t){t.pointerclick(e,n.x,n.y)}else{this.trigger("blank:pointerclick",e,n.x,n.y)}}this._mousemoved=false},pointerdown:function(e){e=joint.util.normalizeEvent(e);var t=this.findView(e.target);var n=this.snapToGrid({x:e.clientX,y:e.clientY});if(t){this.sourceView=t;t.pointerdown(e,n.x,n.y)}else{this.trigger("blank:pointerdown",e,n.x,n.y)}},pointermove:function(e){e.preventDefault();e=joint.util.normalizeEvent(e);if(this.sourceView){this._mousemoved=true;var t=this.snapToGrid({x:e.clientX,y:e.clientY});this.sourceView.pointermove(e,t.x,t.y)}},pointerup:function(e){e=joint.util.normalizeEvent(e);var t=this.snapToGrid({x:e.clientX,y:e.clientY});if(this.sourceView){this.sourceView.pointerup(e,t.x,t.y);this.sourceView=null}else{this.trigger("blank:pointerup",e,t.x,t.y)}}});if(typeof exports==="object"){var joint={util:require("../src/core").util,shapes:{},dia:{Element:require("../src/joint.dia.element").Element,ElementView:require("../src/joint.dia.element").ElementView}};var _=require("lodash")}joint.shapes.basic={};joint.shapes.basic.Generic=joint.dia.Element.extend({defaults:joint.util.deepSupplement({type:"basic.Generic",attrs:{".":{fill:"#FFFFFF",stroke:"none"}}},joint.dia.Element.prototype.defaults)});joint.shapes.basic.Rect=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Rect",attrs:{rect:{fill:"#FFFFFF",stroke:"black",width:100,height:60},text:{"font-size":14,text:"","ref-x":.5,"ref-y":.5,ref:"rect","y-alignment":"middle","x-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Text=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><text/></g></g>',defaults:joint.util.deepSupplement({type:"basic.Text",attrs:{text:{"font-size":18,fill:"black"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Circle=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Circle",size:{width:60,height:60},attrs:{circle:{fill:"#FFFFFF",stroke:"black",r:30,transform:"translate(30, 30)"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,ref:"circle","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Image=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Image",attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,ref:"image","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Path=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Path",size:{width:60,height:60},attrs:{path:{fill:"#FFFFFF",stroke:"black"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,ref:"path","y-alignment":"middle",fill:"black","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)});joint.shapes.basic.Rhombus=joint.shapes.basic.Path.extend({defaults:joint.util.deepSupplement({type:"basic.Rhombus",attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5}}},joint.shapes.basic.Path.prototype.defaults)});joint.shapes.basic.PortsModelInterface={initialize:function(){this.updatePortsAttrs();this.on("change:inPorts change:outPorts",this.updatePortsAttrs,this);this.constructor.__super___.constructor.__super___.initialize.apply(this,arguments)},updatePortsAttrs:function(e){var t=this.get("attrs");__.each(this._portSelectors,function(e){if(t[e])delete t[e]});this._portSelectors=[];var n={};__.each(this.get("inPorts"),function(e,t,r){var i=this.getPortAttrs(e,t,r.length,".inPorts","in");this._portSelectors=this._portSelectors.concat(__.keys(i));__.extend(n,i)},this);__.each(this.get("outPorts"),function(e,t,r){var i=this.getPortAttrs(e,t,r.length,".outPorts","out");this._portSelectors=this._portSelectors.concat(__.keys(i));__.extend(n,i)},this);this.attr(n,{silent:true});this.processPorts();this.trigger("process:ports")},getPortSelector:function(e){var t=".inPorts";var n=this.get("inPorts").indexOf(e);if(n<0){t=".outPorts";n=this.get("outPorts").indexOf(e);if(n<0)throw new Error("getPortSelector(): Port doesn't exist.")}return t+">g:nth-child("+(n+1)+")>circle"}};joint.shapes.basic.PortsViewInterface={initialize:function(){this.listenTo(this.model,"process:ports",this.update);joint.dia.ElementView.prototype.initialize.apply(this,arguments)},update:function(){this.renderPorts();joint.dia.ElementView.prototype.update.apply(this,arguments)},renderPorts:function(){var e=this.$(".inPorts").empty();var t=this.$(".outPorts").empty();var n=__.template(this.model.portMarkup);__.each(__.filter(this.model.ports,function(e){return e.type==="in"}),function(t,r){e.append(V(n({id:r,port:t})).node)});__.each(__.filter(this.model.ports,function(e){return e.type==="out"}),function(e,r){t.append(V(n({id:r,port:e})).node)})}};joint.shapes.basic.TextBlock=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable"><g class="scalable"><rect/></g><switch>','<foreignObject requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" class="fobj">','<body xmlns="http://www.w3.org/1999/xhtml"><div/></body>',"</foreignObject>",'<text class="content"/>',"</switch></g>"].join(""),defaults:joint.util.deepSupplement({type:"basic.TextBlock",attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"",ref:"rect","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){if(typeof SVGForeignObjectElement!=="undefined"){this.setForeignObjectSize(this,this.get("size"));this.setDivContent(this,this.get("content"));this.listenTo(this,"change:size",this.setForeignObjectSize);this.listenTo(this,"change:content",this.setDivContent)}joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},setForeignObjectSize:function(e,t){e.attr({".fobj":__.clone(t),div:{style:__.clone(t)}})},setDivContent:function(e,t){e.attr({div:{html:t}})}});joint.shapes.basic.TextBlockView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments);if(typeof SVGForeignObjectElement==="undefined"){this.noSVGForeignObjectElement=true;this.listenTo(this.model,"change:content",function(e){this.updateContent(e)})}},update:function(e,t){if(this.noSVGForeignObjectElement){var n=this.model;var r=__.omit(t||n.get("attrs"),".content");joint.dia.ElementView.prototype.update.call(this,n,r);if(!t||__.has(t,".content")){this.updateContent(n,t)}}else{joint.dia.ElementView.prototype.update.call(this,n,t)}},updateContent:function(e,t){var n=__.merge({},(t||e.get("attrs"))[".content"]);delete n.text;var r=joint.util.breakText(e.get("content"),e.get("size"),n,{svgDocument:this.paper.svg});var i=joint.util.setByPath({},".content",n,"/");i[".content"].text=r;joint.dia.ElementView.prototype.update.call(this,e,i)}});if(typeof exports==="object"){module.exports=joint.shapes.basic}joint.routers.orthogonal=function(){function n(e,t){if(e.y<t.y&&e.x===t.x){return"down"}else if(e.y>t.y&&e.x===t.x){return"up"}else if(e.x<t.x&&e.y===t.y){return"right"}return"left"}function r(e,t,n){var r;if(e.x<t.x){if(e.y>t.y){r=["up","right"]}else if(e.y<t.y){r=["down","right"]}else{r=["right"]}}else if(e.x>t.x){if(e.y>t.y){r=["up","left"]}else if(e.y<t.y){r=["down","left"]}else{r=["left"]}}else{if(e.y>t.y){r=["up"]}else{r=["down"]}}if(__.contains(r,n)){return n}var i=__.first(r);switch(n){case"down":if(i==="up")return __.last(r);break;case"up":if(i==="down")return __.last(r);break;case"left":if(i==="right")return __.last(r);break;case"right":if(i==="left")return __.last(r);break}return i}function i(e,t,n){var i=r(e,t,n);if(i==="down"||i==="up"){return{x:e.x,y:t.y,d:i}}return{x:t.x,y:e.y,d:i}}function s(r){r=(r||[]).slice();var s=[];var o=e.center();var u=t.center();if(!r.length){if(Math.abs(o.x-u.x)<e.width/2||Math.abs(o.y-u.y)<e.height/2){r=[{x:Math.min(o.x,u.x)+Math.abs(o.x-u.x)/2,y:Math.min(o.y,u.y)+Math.abs(o.y-u.y)/2}]}}r.unshift(o);r.push(u);var a;var f;var l;var c;for(var h=0;h<r.length-1;h++){l=r[h];c=r[h+1];f=__.last(s);if(h>0){a=l;a.d=f?n(f,l):"top";s.push(a);f=a}var p=f&&f.d;a=i(l,c,p);if(!g.point(a).equals(g.point(l))&&!g.point(a).equals(g.point(c))){s.push(a)}}return s}var e,t;return function(n){e=this.sourceBBox;t=this.targetBBox;return s(n)}}();joint.routers.manhattan=function(){"use strict";function t(e,t){var n=[];var r={x:0,y:0};var i=t;var s;while(s=e[i]){var o=s.difference(i);if(!o.equals(r)){n.unshift(i);r=o}i=s}n.unshift(i);return n}function n(e,t,n){var r=n.step;var i=e.center();var s=__.chain(n.directionMap).pick(t).map(function(t){var n=t.x*e.width/2;var s=t.y*e.height/2;var o=g.point(i).offset(n,s).snapToGrid(r);if(e.containsPoint(o)){o.offset(t.x*r,t.y*r)}return o}).value();return s}function r(e,t,n){var r=360/n;var i=Math.floor(e.theta(t)/r);return n-i}function i(e,i,s,o){var u=o.reversed?o.endDirections:o.startDirections;var a=o.reversed?o.startDirections:o.endDirections;var f=e instanceof g.rect?n(e,u,o):[e];var l=i instanceof g.rect?n(i,a,o):[i];var c=f.length>1?e.center():f[0];var h=l.length>1?i.center():l[0];var p=__.filter(l,function(e){var t=g.point(e).snapToGrid(o.mapGridSize).toString();var n=__.every(s[t],function(t){return!t.containsPoint(e)});return n});if(p.length){var d=o.step;var v=o.penalties;var m=__.chain(p).invoke("snapToGrid",d).min(function(e){return o.estimateCost(c,e)}).value();var y={};var b={};var w={};var E=o.directions;var S=E.length;var x=S/2;var T=o.previousDirIndexes||{};var N={};var C={};var k=__.chain(f).invoke("snapToGrid",d).each(function(e){var t=e.toString();b[t]=0;w[t]=o.estimateCost(e,m);T[t]=T[t]||r(c,e,S);C[t]=true}).map(function(e){return e.toString()}).sortBy(function(e){return w[e]}).value();var L=o.maximumLoops;var A=o.maxAllowedDirectionChange;while(k.length&&L--){var O=k[0];var M=g.point(O);if(m.equals(M)){o.previousDirIndexes=__.pick(T,O);return t(y,M)}k.splice(0,1);C[F]=null;N[F]=true;var _=T[O];var D=b[O];for(var P=0;P<S;P++){var H=Math.abs(P-_);if(H>x){H=S-H}if(H>A){continue}var B=E[P];var j=g.point(M).offset(B.offsetX,B.offsetY);var F=j.toString();if(N[F]){continue}var I=g.point(j).snapToGrid(o.mapGridSize).toString();var q=__.every(s[I],function(e){return!e.containsPoint(j)});if(!q){continue}var R=__.has(C,F);var U=D+B.cost;if(!R||U<b[F]){y[F]=M;T[F]=P;b[F]=U;w[F]=U+o.estimateCost(j,m)+v[H];if(!R){var z=__.sortedIndex(k,F,function(e){return w[e]});k.splice(z,0,F);C[F]=true}}}}}return o.fallbackRoute(c,h,o)}function s(e,t){t.directions=__.result(t,"directions");t.penalties=__.result(t,"penalties");t.paddingBox=__.result(t,"paddingBox");this.options.perpendicular=!!t.perpendicular;var n=t.reversed=this.lastEndChange==="source";var r=n?g.rect(this.targetBBox):g.rect(this.sourceBBox);var s=n?g.rect(this.sourceBBox):g.rect(this.targetBBox);r.moveAndExpand(t.paddingBox);s.moveAndExpand(t.paddingBox);var o=this.model;var u=this.paper.model;var a=__.chain(t.excludeEnds).map(o.get,o).pluck("id").map(u.getCell,u).value();var f=t.mapGridSize;var l=__.chain(u.getElements()).difference(a).reject(function(e){return __.contains(t.excludeTypes,e.get("type"))}).invoke("getBBox").invoke("moveAndExpand",t.paddingBox).foldl(function(e,t){var n=t.origin().snapToGrid(f);var r=t.corner().snapToGrid(f);for(var i=n.x;i<=r.x;i+=f){for(var s=n.y;s<=r.y;s+=f){var o=i+"@"+s;e[o]=e[o]||[];e[o].push(t)}}return e},{}).value();var c=[];var h=__.map(e,g.point);var p=r.center();for(var d=0,v=h.length;d<=v;d++){var m=null;var y=b||r;var b=h[d];if(!b){b=s;var w=!this.model.get("source").id||!this.model.get("target").id;if(w&&__.isFunction(t.draggingRoute)){var E=y instanceof g.rect?y.center():y;m=t.draggingRoute(E,b.origin(),t)}}m=m||i(y,b,l,t);var S=__.first(m);if(S&&S.equals(p)){m.shift()}p=__.last(m)||p;c=c.concat(m)}return n?c.reverse():c}var e={step:10,perpendicular:true,mapGridSize:100,excludeEnds:[],excludeTypes:["basic.Text"],maximumLoops:500,startDirections:["left","right","top","bottom"],endDirections:["left","right","top","bottom"],directionMap:{right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0},top:{x:0,y:-1}},maxAllowedDirectionChange:1,paddingBox:function(){var e=this.step;return{x:-e,y:-e,width:2*e,height:2*e}},directions:function(){var e=this.step;return[{offsetX:e,offsetY:0,cost:e},{offsetX:0,offsetY:e,cost:e},{offsetX:-e,offsetY:0,cost:e},{offsetX:0,offsetY:-e,cost:e}]},penalties:function(){return[0,this.step/2,this.step]},estimateCost:function(e,t){return e.manhattanDistance(t)},fallbackRoute:function(e,t,n){var r=n.prevDirIndexes||{};var i=(r[e]||0)%2?g.point(e.x,t.y):g.point(t.x,e.y);return[i,t]},draggingRoute:null};return function(t,n,r){return s.call(r,t,__.extend({},e,n))}}();joint.routers.metro=function(){if(!__.isFunction(joint.routers.manhattan)){throw"Metro requires the manhattan router."}var e={diagonalCost:null,directions:function(){var e=this.step;var t=this.diagonalCost||Math.ceil(Math.sqrt(e*e<<1));return[{offsetX:e,offsetY:0,cost:e},{offsetX:e,offsetY:e,cost:t},{offsetX:0,offsetY:e,cost:e},{offsetX:-e,offsetY:e,cost:t},{offsetX:-e,offsetY:0,cost:e},{offsetX:-e,offsetY:-e,cost:t},{offsetX:0,offsetY:-e,cost:e},{offsetX:e,offsetY:-e,cost:t}]},fallbackRoute:function(e,t,n){var r=e.theta(t);var i={x:t.x,y:e.y};var s={x:e.x,y:t.y};if(r%180>90){var o=i;i=s;s=o}var u=r%90<45?i:s;var a=g.line(e,u);var f=90*Math.ceil(r/90);var l=g.point.fromPolar(a.squaredLength(),g.toRad(f+135),u);var c=g.line(t,l);var h=a.intersection(c);return h?[h.round(),t]:[t]}};return function(t,n,r){return joint.routers.manhattan(t,__.extend({},e,n),r)}}();joint.connectors.normal=function(e,t,n){var r=["M",e.x,e.y];__.each(n,function(e){r.push(e.x,e.y)});r.push(t.x,t.y);return r.join(" ")};joint.connectors.rounded=function(e,t,n,r){var i=r.radius||10;var s,o,u,a,f,l;var c=["M",e.x,e.y];__.each(n,function(r,h){f=n[h-1]||e;l=n[h+1]||t;u=a||g.point(r).distance(f)/2;a=g.point(r).distance(l)/2;s=g.point(r).move(f,-Math.min(i,u)).round();o=g.point(r).move(l,-Math.min(i,a)).round();c.push(s.x,s.y,"S",r.x,r.y,o.x,o.y,"L")});c.push(t.x,t.y);return c.join(" ")};joint.connectors.smooth=function(e,t,n){var r;if(n.length){r=g.bezier.curveThroughPoints([e].concat(n).concat([t]))}else{var i=e.x<t.x?t.x-(t.x-e.x)/2:e.x-(e.x-t.x)/2;r=["M",e.x,e.y,"C",i,e.y,i,t.y,t.x,t.y]}return r.join(" ")};(function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i})({1:[function(e,t,n){var r=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};r.dagre=e("./index")},{"./index":2}],2:[function(e,t,n){n.Digraph=e("graphlib").Digraph;n.Graph=e("graphlib").Graph;n.layout=e("./lib/layout");n.version=e("./lib/version")},{"./lib/layout":3,"./lib/version":18,graphlib:24}],3:[function(e,t,n){var r=e("./util"),i=e("./rank"),s=e("./order"),o=e("graphlib").CGraph,u=e("graphlib").CDigraph;t.exports=function(){function f(e){var n=new u;e.eachNode(function(e,t){if(t===undefined)t={};n.addNode(e,{width:t.width,height:t.height});if(t.hasOwnProperty("rank")){n.node(e).prefRank=t.rank}});if(e.parent){e.nodes().forEach(function(t){n.parent(t,e.parent(t))})}e.eachEdge(function(e,t,r,i){if(i===undefined)i={};var s={e:e,minLen:i.minLen||1,width:i.width||0,height:i.height||0,points:[]};n.addEdge(null,t,r,s)});var r=e.graph()||{};n.graph({rankDir:r.rankDir||t.rankDir,orderRestarts:r.orderRestarts});return n}function l(e){var o=a.rankSep();var u;try{u=r.time("initLayoutGraph",f)(e);if(u.order()===0){return u}u.eachEdge(function(e,t,n,r){r.minLen*=2});a.rankSep(o/2);r.time("rank.run",i.run)(u,t.rankSimplex);r.time("normalize",c)(u);r.time("order",s)(u,t.orderMaxSweeps);r.time("position",n.run)(u);r.time("undoNormalize",h)(u);r.time("fixupEdgePoints",p)(u);r.time("rank.restoreEdges",i.restoreEdges)(u);return r.time("createFinalGraph",d)(u,e.isDirected())}finally{a.rankSep(o)}}function c(e){var t=0;e.eachEdge(function(n,r,i,s){var o=e.node(r).rank;var u=e.node(i).rank;if(o+1<u){for(var a=r,f=o+1,l=0;f<u;++f,++l){var c="_D"+ ++t;var h={width:s.width,height:s.height,edge:{id:n,source:r,target:i,attrs:s},rank:f,dummy:true};if(l===0)h.index=0;else if(f+1===u)h.index=1;e.addNode(c,h);e.addEdge(null,a,c,{});a=c}e.addEdge(null,a,i,{});e.delEdge(n)}})}function h(e){e.eachNode(function(t,n){if(n.dummy){if("index"in n){var r=n.edge;if(!e.hasEdge(r.id)){e.addEdge(r.id,r.source,r.target,r.attrs)}var i=e.edge(r.id).points;i[n.index]={x:n.x,y:n.y,ul:n.ul,ur:n.ur,dl:n.dl,dr:n.dr}}e.delNode(t)}})}function p(e){e.eachEdge(function(e,t,n,r){if(r.reversed)r.points.reverse()})}function d(e,t){var n=t?new u:new o;n.graph(e.graph());e.eachNode(function(e,t){n.addNode(e,t)});e.eachNode(function(t){n.parent(t,e.parent(t))});e.eachEdge(function(e,t,r,i){n.addEdge(i.e,t,r,i)});var r=0,i=0;e.eachNode(function(t,n){if(!e.children(t).length){r=Math.max(r,n.x+n.width/2);i=Math.max(i,n.y+n.height/2)}});e.eachEdge(function(e,t,n,s){var o=Math.max.apply(Math,s.points.map(function(e){return e.x}));var u=Math.max.apply(Math,s.points.map(function(e){return e.y}));r=Math.max(r,o+s.width/2);i=Math.max(i,u+s.height/2)});n.graph().width=r;n.graph().height=i;return n}function v(e){return function(){if(!arguments.length)return e();e.apply(null,arguments);return a}}var t={debugLevel:0,orderMaxSweeps:s.DEFAULT_MAX_SWEEPS,rankSimplex:false,rankDir:"TB"};var n=e("./position")();var a={};a.orderIters=r.propertyAccessor(a,t,"orderMaxSweeps");a.rankSimplex=r.propertyAccessor(a,t,"rankSimplex");a.nodeSep=v(n.nodeSep);a.edgeSep=v(n.edgeSep);a.universalSep=v(n.universalSep);a.rankSep=v(n.rankSep);a.rankDir=r.propertyAccessor(a,t,"rankDir");a.debugAlignment=v(n.debugAlignment);a.debugLevel=r.propertyAccessor(a,t,"debugLevel",function(e){r.log.level=e;n.debugLevel(e)});a.run=r.time("Total layout",l);a._normalize=c;return a}},{"./order":4,"./position":9,"./rank":10,"./util":17,graphlib:24}],4:[function(e,t,n){function l(e,t){function d(){e.eachNode(function(e,t){h[e]=t.order})}if(arguments.length<2){t=f}var n=e.graph().orderRestarts||0;var i=o(e);i.forEach(function(t){t=t.filterNodes(function(t){return!e.children(t).length})});var a=0,l,c=Number.MAX_VALUE,h={};for(var v=0;v<Number(n)+1&&c!==0;++v){l=Number.MAX_VALUE;u(e,n>0);r.log(2,"Order phase start cross count: "+e.graph().orderInitCC);var m,g,y;for(m=0,g=0;g<4&&m<t&&l>0;++m,++g,++a){p(e,i,m);y=s(e);if(y<l){g=0;l=y;if(y<c){d();c=y}}r.log(3,"Order phase start "+v+" iter "+m+" cross count: "+y)}}Object.keys(h).forEach(function(t){if(!e.children||!e.children(t).length){e.node(t).order=h[t]}});e.graph().orderCC=c;r.log(2,"Order iterations: "+a);r.log(2,"Order phase best cross count: "+e.graph().orderCC)}function c(e,t){var n={};t.forEach(function(t){n[t]=e.inEdges(t).map(function(t){return e.node(e.source(t)).order})});return n}function h(e,t){var n={};t.forEach(function(t){n[t]=e.outEdges(t).map(function(t){return e.node(e.target(t)).order})});return n}function p(e,t,n){if(n%2===0){d(e,t,n)}else{v(e,t,n)}}function d(e,t){var n;for(i=1;i<t.length;++i){n=a(t[i],n,c(e,t[i].nodes()))}}function v(e,t){var n;for(i=t.length-2;i>=0;--i){a(t[i],n,h(e,t[i].nodes()))}}var r=e("./util"),s=e("./order/crossCount"),o=e("./order/initLayerGraphs"),u=e("./order/initOrder"),a=e("./order/sortLayer");t.exports=l;var f=24;l.DEFAULT_MAX_SWEEPS=f},{"./order/crossCount":5,"./order/initLayerGraphs":6,"./order/initOrder":7,"./order/sortLayer":8,"./util":17}],5:[function(e,t,n){function i(e){var t=0;var n=r.ordering(e);for(var i=1;i<n.length;++i){t+=s(e,n[i-1],n[i])}return t}function s(e,t,n){var r=[];t.forEach(function(t){var n=[];e.outEdges(t).forEach(function(t){n.push(e.node(e.target(t)).order)});n.sort(function(e,t){return e-t});r=r.concat(n)});var i=1;while(i<n.length)i<<=1;var s=2*i-1;i-=1;var o=[];for(var u=0;u<s;++u){o[u]=0}var a=0;r.forEach(function(e){var t=e+i;++o[t];while(t>0){if(t%2){a+=o[t+1]}t=t-1>>1;++o[t]}});return a}var r=e("../util");t.exports=i},{"../util":17}],6:[function(e,t,n){function s(e){function n(r){if(r===null){e.children(r).forEach(function(e){n(e)});return}var s=e.node(r);s.minRank="rank"in s?s.rank:Number.MAX_VALUE;s.maxRank="rank"in s?s.rank:Number.MIN_VALUE;var o=new i;e.children(r).forEach(function(t){var r=n(t);o=i.union([o,r]);s.minRank=Math.min(s.minRank,e.node(t).minRank);s.maxRank=Math.max(s.maxRank,e.node(t).maxRank)});if("rank"in s)o.add(s.rank);o.keys().forEach(function(e){if(!(e in t))t[e]=[];t[e].push(r)});return o}var t=[];n(null);var s=[];t.forEach(function(t,n){s[n]=e.filterNodes(r(t))});return s}var r=e("graphlib").filter.nodesFromList,i=e("cp-data").Set;t.exports=s},{"cp-data":19,graphlib:24}],7:[function(e,t,n){function s(e,t){var n=[];e.eachNode(function(t,r){var i=n[r.rank];if(e.children&&e.children(t).length>0)return;if(!i){i=n[r.rank]=[]}i.push(t)});n.forEach(function(n){if(t){i.shuffle(n)}n.forEach(function(t,n){e.node(t).order=n})});var s=r(e);e.graph().orderInitCC=s;e.graph().orderCC=Number.MAX_VALUE}var r=e("./crossCount"),i=e("../util");t.exports=s},{"../util":17,"./crossCount":5}],8:[function(e,t,n){function i(e,t,n){var i=[];var s={};e.eachNode(function(e,t){i[t.order]=e;var o=n[e];if(o.length){s[e]=r.sum(o)/o.length}});var o=e.nodes().filter(function(e){return s[e]!==undefined});o.sort(function(t,n){return s[t]-s[n]||e.node(t).order-e.node(n).order});for(var u=0,a=0,f=o.length;a<f;++u){if(s[i[u]]!==undefined){e.node(o[a++]).order=u}}}var r=e("../util");t.exports=i},{"../util":17}],9:[function(e,t,n){var r=e("./util");t.exports=function(){function n(t){t=t.filterNodes(r.filterNonSubgraphs(t));var n=r.ordering(t);var i=s(t,n);var a={};["u","d"].forEach(function(r){if(r==="d")n.reverse();["l","r"].forEach(function(s){if(s==="r")h(n);var f=r+s;var l=o(t,n,i,r==="u"?"predecessors":"successors");a[f]=u(t,n,l.pos,l.root,l.align);if(e.debugLevel>=3)b(r+s,t,n,a[f]);if(s==="r")c(a[f]);if(s==="r")h(n)});if(r==="d")n.reverse()});l(t,n,a);t.eachNode(function(e){var n=[];for(var r in a){var i=a[r][e];g(r,t,e,i);n.push(i)}n.sort(function(e,t){return e-t});m(t,e,(n[1]+n[2])/2)});var f=0,v=t.graph().rankDir==="BT"||t.graph().rankDir==="RL";n.forEach(function(n){var i=r.max(n.map(function(e){return d(t,e)}));f+=i/2;n.forEach(function(e){y(t,e,v?-f:f)});f+=i/2+e.rankSep});var w=r.min(t.nodes().map(function(e){return m(t,e)-p(t,e)/2}));var E=r.min(t.nodes().map(function(e){return y(t,e)-d(t,e)/2}));t.eachNode(function(e){m(t,e,m(t,e)-w);y(t,e,y(t,e)-E)})}function i(e,t){return e<t?e.toString().length+":"+e+"-"+t:t.toString().length+":"+t+"-"+e}function s(e,t){function l(e){var t=r[e];if(t<u||t>f){n[i(o[a],e)]=true}}var n={},r={},s,o,u,a,f;if(t.length<=2)return n;t[1].forEach(function(e,t){r[e]=t});for(var c=1;c<t.length-1;++c){s=t[c];o=t[c+1];u=0;a=0;for(var h=0;h<o.length;++h){var p=o[h];r[p]=h;f=undefined;if(e.node(p).dummy){var d=e.predecessors(p)[0];if(d!==undefined&&e.node(d).dummy)f=r[d]}if(f===undefined&&h===o.length-1)f=s.length-1;if(f!==undefined){for(;a<=h;++a){e.predecessors(o[a]).forEach(l)}u=f}}}return n}function o(e,t,n,r){var s={},o={},u={};t.forEach(function(e){e.forEach(function(e,t){o[e]=e;u[e]=e;s[e]=t})});t.forEach(function(t){var a=-1;t.forEach(function(t){var f=e[r](t),l;if(f.length>0){f.sort(function(e,t){return s[e]-s[t]});l=(f.length-1)/2;f.slice(Math.floor(l),Math.ceil(l)+1).forEach(function(e){if(u[t]===t){if(!n[i(e,t)]&&a<s[e]){u[e]=t;u[t]=o[t]=o[e];a=s[e]}}})}})});return{pos:s,root:o,align:u}}function u(e,t,n,i,s){function c(e,t,n){if(!(t in u[e])){u[e][t]=n}else{u[e][t]=Math.min(u[e][t],n)}}function h(t){if(!(t in l)){l[t]=0;var r=t;do{if(n[r]>0){var u=i[f[r]];h(u);if(o[t]===t){o[t]=o[u]}var a=v(e,f[r])+v(e,r);if(o[t]!==o[u]){c(o[u],o[t],l[t]-l[u]-a)}else{l[t]=Math.max(l[t],l[u]+a)}}r=s[r]}while(r!==t)}}var o={},u={},a={},f={},l={};t.forEach(function(e){e.forEach(function(t,n){o[t]=t;u[t]={};if(n>0)f[t]=e[n-1]})});r.values(i).forEach(function(e){h(e)});t.forEach(function(e){e.forEach(function(e){l[e]=l[i[e]];if(e===i[e]&&e===o[e]){var t=0;if(e in u&&Object.keys(u[e]).length>0){t=r.min(Object.keys(u[e]).map(function(t){return u[e][t]+(t in a?a[t]:0)}))}a[e]=t}})});t.forEach(function(e){e.forEach(function(e){l[e]+=a[o[i[e]]]||0})});return l}function a(e,t,n){return r.min(t.map(function(e){var t=e[0];return n[t]}))}function f(e,t,n){return r.max(t.map(function(e){var t=e[e.length-1];return n[t]}))}function l(e,t,n){function u(e){n[c][e]+=o[c]}var r={},i={},s,o={};var l=Number.POSITIVE_INFINITY;for(var c in n){var h=n[c];r[c]=a(e,t,h);i[c]=f(e,t,h);var p=i[c]-r[c];if(p<l){l=p;s=c}}["u","d"].forEach(function(e){["l","r"].forEach(function(t){var n=e+t;o[n]=t==="l"?r[s]-r[n]:i[s]-i[n]})});for(c in n){e.eachNode(u)}}function c(e){for(var t in e){e[t]=-e[t]}}function h(e){e.forEach(function(e){e.reverse()})}function p(e,t){switch(e.graph().rankDir){case"LR":return e.node(t).height;case"RL":return e.node(t).height;default:return e.node(t).width}}function d(e,t){switch(e.graph().rankDir){case"LR":return e.node(t).width;case"RL":return e.node(t).width;default:return e.node(t).height}}function v(t,n){if(e.universalSep!==null){return e.universalSep}var r=p(t,n);var i=t.node(n).dummy?e.edgeSep:e.nodeSep;return(r+i)/2}function m(e,t,n){if(e.graph().rankDir==="LR"||e.graph().rankDir==="RL"){if(arguments.length<3){return e.node(t).y}else{e.node(t).y=n}}else{if(arguments.length<3){return e.node(t).x}else{e.node(t).x=n}}}function g(e,t,n,r){if(t.graph().rankDir==="LR"||t.graph().rankDir==="RL"){if(arguments.length<3){return t.node(n)[e]}else{t.node(n)[e]=r}}else{if(arguments.length<3){return t.node(n)[e]}else{t.node(n)[e]=r}}}function y(e,t,n){if(e.graph().rankDir==="LR"||e.graph().rankDir==="RL"){if(arguments.length<3){return e.node(t).x}else{e.node(t).x=n}}else{if(arguments.length<3){return e.node(t).y}else{e.node(t).y=n}}}function b(e,t,n,r){n.forEach(function(n,i){var s,o;n.forEach(function(n){var u=r[n];if(s){var a=v(t,s)+v(t,n);if(u-o<a)console.log("Position phase: sep violation. Align: "+e+". Layer: "+i+". "+"U: "+s+" V: "+n+". Actual sep: "+(u-o)+" Expected sep: "+a)}s=n;o=u})})}var e={nodeSep:50,edgeSep:10,universalSep:null,rankSep:30};var t={};t.nodeSep=r.propertyAccessor(t,e,"nodeSep");t.edgeSep=r.propertyAccessor(t,e,"edgeSep");t.universalSep=r.propertyAccessor(t,e,"universalSep");t.rankSep=r.propertyAccessor(t,e,"rankSep");t.debugLevel=r.propertyAccessor(t,e,"debugLevel");t.run=n;return t}},{"./util":17}],10:[function(e,t,n){function c(e,t){p(e);r.time("constraints.apply",u.apply)(e);d(e);r.time("acyclic",i)(e);var n=e.filterNodes(r.filterNonSubgraphs(e));s(n);f(n).forEach(function(e){var r=n.filterNodes(l.nodesFromList(e));g(r,t)});r.time("constraints.relax",u.relax(e));r.time("reorientEdges",m)(e)}function h(e){i.undo(e)}function p(e){e.eachEdge(function(t,n,r,i){if(n===r){var s=v(e,t,n,r,i,0,false),o=v(e,t,n,r,i,1,true),u=v(e,t,n,r,i,2,false);e.addEdge(null,s,n,{minLen:1,selfLoop:true});e.addEdge(null,s,o,{minLen:1,selfLoop:true});e.addEdge(null,n,u,{minLen:1,selfLoop:true});e.addEdge(null,o,u,{minLen:1,selfLoop:true});e.delEdge(t)}})}function d(e){e.eachEdge(function(t,n,r,i){if(n===r){var s=i.originalEdge,o=v(e,s.e,s.u,s.v,s.value,0,true);e.addEdge(null,n,o,{minLen:1});e.addEdge(null,o,r,{minLen:1});e.delEdge(t)}})}function v(e,t,n,r,i,s,o){return e.addNode(null,{width:o?i.width:0,height:o?i.height:0,edge:{id:t,source:n,target:r,attrs:i},dummy:true,index:s})}function m(e){e.eachEdge(function(t,n,r,i){if(e.node(n).rank>e.node(r).rank){e.delEdge(t);i.reversed=true;e.addEdge(t,r,n,i)}})}function g(e,t){var n=o(e);if(t){r.log(1,"Using network simplex for ranking");a(e,n)}y(e)}function y(e){var t=r.min(e.nodes().map(function(t){return e.node(t).rank}));e.eachNode(function(e,n){n.rank-=t})}var r=e("./util"),i=e("./rank/acyclic"),s=e("./rank/initRank"),o=e("./rank/feasibleTree"),u=e("./rank/constraints"),a=e("./rank/simplex"),f=e("graphlib").alg.components,l=e("graphlib").filter;n.run=c;n.restoreEdges=h},{"./rank/acyclic":11,"./rank/constraints":12,"./rank/feasibleTree":13,"./rank/initRank":14,"./rank/simplex":16,"./util":17,graphlib:24}],11:[function(e,t,n){function i(e){function s(r){if(r in n)return;n[r]=t[r]=true;e.outEdges(r).forEach(function(n){var o=e.target(n),a;if(r===o){console.error('Warning: found self loop "'+n+'" for node "'+r+'"')}else if(o in t){a=e.edge(n);e.delEdge(n);a.reversed=true;++i;e.addEdge(n,o,r,a)}else{s(o)}});delete t[r]}var t={},n={},i=0;e.eachNode(function(e){s(e)});r.log(2,"Acyclic Phase: reversed "+i+" edge(s)");return i}function s(e){e.eachEdge(function(t,n,r,i){if(i.reversed){delete i.reversed;e.delEdge(t);e.addEdge(t,r,n,i)}})}var r=e("../util");t.exports=i;t.exports.undo=s},{"../util":17}],12:[function(e,t,n){function r(e){if(e!=="min"&&e!=="max"&&e.indexOf("same_")!==0){console.error("Unsupported rank type: "+e);return false}return true}function i(e,t,n,r){e.inEdges(t).forEach(function(t){var i=e.edge(t),s;if(i.originalEdge){s=i}else{s={originalEdge:{e:t,u:e.source(t),v:e.target(t),value:i},minLen:e.edge(t).minLen}}if(i.selfLoop){r=false}if(r){e.addEdge(null,n,e.source(t),s);s.reversed=true}else{e.addEdge(null,e.source(t),n,s)}})}function s(e,t,n,r){e.outEdges(t).forEach(function(t){var i=e.edge(t),s;if(i.originalEdge){s=i}else{s={originalEdge:{e:t,u:e.source(t),v:e.target(t),value:i},minLen:e.edge(t).minLen}}if(i.selfLoop){r=false}if(r){e.addEdge(null,e.target(t),n,s);s.reversed=true}else{e.addEdge(null,n,e.target(t),s)}})}function o(e,t,n){if(n!==undefined){e.children(t).forEach(function(t){if(t!==n&&!e.outEdges(n,t).length&&!e.node(t).dummy){e.addEdge(null,n,t,{minLen:0})}})}}function u(e,t,n){if(n!==undefined){e.children(t).forEach(function(t){if(t!==n&&!e.outEdges(t,n).length&&!e.node(t).dummy){e.addEdge(null,t,n,{minLen:0})}})}}n.apply=function(e){function t(n){var a={};e.children(n).forEach(function(o){if(e.children(o).length){t(o);return}var u=e.node(o),f=u.prefRank;if(f!==undefined){if(!r(f)){return}if(!(f in a)){a.prefRank=[o]}else{a.prefRank.push(o)}var l=a[f];if(l===undefined){l=a[f]=e.addNode(null,{originalNodes:[]});e.parent(l,n)}i(e,o,l,f==="min");s(e,o,l,f==="max");e.node(l).originalNodes.push({u:o,value:u,parent:n});e.delNode(o)}});o(e,n,a.min);u(e,n,a.max)}t(null)};n.relax=function(e){var t=[];e.eachEdge(function(e,n,r,i){var s=i.originalEdge;if(s){t.push(s)}});e.eachNode(function(t,n){var r=n.originalNodes;if(r){r.forEach(function(t){t.value.rank=n.rank;e.addNode(t.u,t.value);e.parent(t.u,t.parent)});e.delNode(t)}});t.forEach(function(t){e.addEdge(t.e,t.u,t.v,t.value)})}},{}],13:[function(e,t,n){function o(e){function o(r){var i=true;e.predecessors(r).forEach(function(s){if(t.has(s)&&!u(e,s,r)){if(t.has(r)){n.addNode(r,{});t.remove(r);n.graph({root:r})}n.addNode(s,{});n.addEdge(null,s,r,{reversed:true});t.remove(s);o(s);i=false}});e.successors(r).forEach(function(s){if(t.has(s)&&!u(e,r,s)){if(t.has(r)){n.addNode(r,{});t.remove(r);n.graph({root:r})}n.addNode(s,{});n.addEdge(null,r,s,{});t.remove(s);o(s);i=false}});return i}function a(){var r=Number.MAX_VALUE;t.keys().forEach(function(n){e.predecessors(n).forEach(function(i){if(!t.has(i)){var s=u(e,i,n);if(Math.abs(s)<Math.abs(r)){r=-s}}});e.successors(n).forEach(function(i){if(!t.has(i)){var s=u(e,n,i);if(Math.abs(s)<Math.abs(r)){r=s}}})});n.eachNode(function(t){e.node(t).rank-=r})}var t=new r(e.nodes()),n=new i;if(t.size()===1){var s=e.nodes()[0];n.addNode(s,{});n.graph({root:s});return n}while(t.size()){var f=!n.order()?t.keys():n.nodes();for(var l=0,c=f.length;l<c&&o(f[l]);++l);if(t.size()){a()}}return n}function u(e,t,n){var r=e.node(n).rank-e.node(t).rank;var i=s.max(e.outEdges(t,n).map(function(t){return e.edge(t).minLen}));return r-i}var r=e("cp-data").Set,i=e("graphlib").Digraph,s=e("../util");t.exports=o},{"../util":17,"cp-data":19,graphlib:24}],14:[function(e,t,n){function s(e){var t=i(e);t.forEach(function(t){var n=e.inEdges(t);if(n.length===0){e.node(t).rank=0;return}var i=n.map(function(t){return e.node(e.source(t)).rank+e.edge(t).minLen});e.node(t).rank=r.max(i)})}var r=e("../util"),i=e("graphlib").alg.topsort;t.exports=s},{"../util":17,graphlib:24}],15:[function(e,t,n){function r(e,t,n,r){return Math.abs(e.node(t).rank-e.node(n).rank)-r}t.exports={slack:r}},{}],16:[function(e,t,n){function s(e,t){o(e,t);while(true){var n=l(t);if(n===null)break;var r=c(e,t,n);h(e,t,n,r)}}function o(e,t){function n(r){var i=t.successors(r);for(var s in i){var o=i[s];n(o)}if(r!==t.graph().root){a(e,t,r)}}u(t);t.eachEdge(function(e,t,n,r){r.cutValue=0});n(t.graph().root)}function u(e){function n(r){var i=e.successors(r);var s=t;for(var o in i){var u=i[o];n(u);s=Math.min(s,e.node(u).low)}e.node(r).low=s;e.node(r).lim=t++}var t=0;n(e.graph().root)}function a(e,t,n){var r=t.inEdges(n)[0];var i=[];var s=t.outEdges(n);for(var o in s){i.push(t.target(s[o]))}var u=0;var a=0;var l=0;var c=0;var h=0;var p=e.outEdges(n);var d;for(var v in p){var m=e.target(p[v]);for(d in i){if(f(t,m,i[d])){a++}}if(!f(t,m,n)){c++}}var g=e.inEdges(n);for(var y in g){var b=e.source(g[y]);for(d in i){if(f(t,b,i[d])){l++}}if(!f(t,b,n)){h++}}var w=0;for(d in i){var E=t.edge(s[d]).cutValue;if(!t.edge(s[d]).reversed){w+=E}else{w-=E}}if(!t.edge(r).reversed){u+=w-a+l-c+h}else{u-=w-a+l-c+h}t.edge(r).cutValue=u}function f(e,t,n){return e.node(n).low<=e.node(t).lim&&e.node(t).lim<=e.node(n).lim}function l(e){var t=e.edges();for(var n in t){var r=t[n];var i=e.edge(r);if(i.cutValue<0){return r}}return null}function c(e,t,n){var r=t.source(n);var s=t.target(n);var o=t.node(s).lim<t.node(r).lim?s:r;var u=!t.edge(n).reversed;var a=Number.POSITIVE_INFINITY;var l;if(u){e.eachEdge(function(r,s,u,c){if(r!==n&&f(t,s,o)&&!f(t,u,o)){var h=i.slack(e,s,u,c.minLen);if(h<a){a=h;l=r}}})}else{e.eachEdge(function(r,s,u,c){if(r!==n&&!f(t,s,o)&&f(t,u,o)){var h=i.slack(e,s,u,c.minLen);if(h<a){a=h;l=r}}})}if(l===undefined){var c=[];var h=[];e.eachNode(function(e){if(!f(t,e,o)){c.push(e)}else{h.push(e)}});throw new Error("No edge found from outside of tree to inside")}return l}function h(e,t,n,r){function u(e){var n=t.inEdges(e);for(var r in n){var i=n[r];var s=t.source(i);var o=t.edge(i);u(s);t.delEdge(i);o.reversed=!o.reversed;t.addEdge(i,e,s,o)}}t.delEdge(n);var i=e.source(r);var s=e.target(r);u(s);var a=i;var f=t.inEdges(a);while(f.length>0){a=t.source(f[0]);f=t.inEdges(a)}t.graph().root=a;t.addEdge(null,i,s,{cutValue:0});o(e,t);p(e,t)}function p(e,t){function n(r){var i=t.successors(r);i.forEach(function(t){var i=d(e,r,t);e.node(t).rank=e.node(r).rank+i;n(t)})}n(t.graph().root)}function d(e,t,n){var i=e.outEdges(t,n);if(i.length>0){return r.max(i.map(function(t){return e.edge(t).minLen}))}var s=e.inEdges(t,n);if(s.length>0){return-r.max(s.map(function(t){return e.edge(t).minLen}))}}var r=e("../util"),i=e("./rankUtil");t.exports=s},{"../util":17,"./rankUtil":15}],17:[function(e,t,n){function r(e,t){return function(){var n=(new Date).getTime();try{return t.apply(null,arguments)}finally{s(1,e+" time: "+((new Date).getTime()-n)+"ms")}}}function s(e){if(s.level>=e){console.log.apply(console,Array.prototype.slice.call(arguments,1))}}n.min=function(e){return Math.min.apply(Math,e)};n.max=function(e){return Math.max.apply(Math,e)};n.all=function(e,t){for(var n=0;n<e.length;++n){if(!t(e[n])){return false}}return true};n.sum=function(e){return e.reduce(function(e,t){return e+t},0)};n.values=function(e){return Object.keys(e).map(function(t){return e[t]})};n.shuffle=function(e){for(i=e.length-1;i>0;--i){var t=Math.floor(Math.random()*(i+1));var n=e[t];e[t]=e[i];e[i]=n}};n.propertyAccessor=function(e,t,n,r){return function(i){if(!arguments.length)return t[n];t[n]=i;if(r)r(i);return e}};n.ordering=function(e){var t=[];e.eachNode(function(e,n){var r=t[n.rank]||(t[n.rank]=[]);r[n.order]=e});return t};n.filterNonSubgraphs=function(e){return function(t){return e.children(t).length===0}};r.enabled=false;n.time=r;s.level=0;n.log=s},{}],18:[function(e,t,n){t.exports="0.4.5"},{}],19:[function(e,t,n){n.Set=e("./lib/Set");n.PriorityQueue=e("./lib/PriorityQueue");n.version=e("./lib/version")},{"./lib/PriorityQueue":20,"./lib/Set":21,"./lib/version":23}],20:[function(e,t,n){function r(){this._arr=[];this._keyIndices={}}t.exports=r;r.prototype.size=function(){return this._arr.length};r.prototype.keys=function(){return this._arr.map(function(e){return e.key})};r.prototype.has=function(e){return e in this._keyIndices};r.prototype.priority=function(e){var t=this._keyIndices[e];if(t!==undefined){return this._arr[t].priority}};r.prototype.min=function(){if(this.size()===0){throw new Error("Queue underflow")}return this._arr[0].key};r.prototype.add=function(e,t){var n=this._keyIndices;if(!(e in n)){var r=this._arr;var i=r.length;n[e]=i;r.push({key:e,priority:t});this._decrease(i);return true}return false};r.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();delete this._keyIndices[e.key];this._heapify(0);return e.key};r.prototype.decrease=function(e,t){var n=this._keyIndices[e];if(t>this._arr[n].priority){throw new Error("New priority is greater than current priority. "+"Key: "+e+" Old: "+this._arr[n].priority+" New: "+t)}this._arr[n].priority=t;this._decrease(n)};r.prototype._heapify=function(e){var t=this._arr;var n=2*e,r=n+1,i=e;if(n<t.length){i=t[n].priority<t[i].priority?n:i;if(r<t.length){i=t[r].priority<t[i].priority?r:i}if(i!==e){this._swap(e,i);this._heapify(i)}}};r.prototype._decrease=function(e){var t=this._arr;var n=t[e].priority;var r;while(e!==0){r=e>>1;if(t[r].priority<n){break}this._swap(e,r);e=r}};r.prototype._swap=function(e,t){var n=this._arr;var r=this._keyIndices;var i=n[e];var s=n[t];n[e]=s;n[t]=i;r[s.key]=e;r[i.key]=t}},{}],21:[function(e,t,n){function i(e){this._size=0;this._keys={};if(e){for(var t=0,n=e.length;t<n;++t){this.add(e[t])}}}function s(e){var t=Object.keys(e),n=t.length,r=new Array(n),i;for(i=0;i<n;++i){r[i]=e[t[i]]}return r}var r=e("./util");t.exports=i;i.intersect=function(e){if(e.length===0){return new i}var t=new i(!r.isArray(e[0])?e[0].keys():e[0]);for(var n=1,s=e.length;n<s;++n){var o=t.keys(),u=!r.isArray(e[n])?e[n]:new i(e[n]);for(var a=0,f=o.length;a<f;++a){var l=o[a];if(!u.has(l)){t.remove(l)}}}return t};i.union=function(e){var t=r.reduce(e,function(e,t){return e+(t.size?t.size():t.length)},0);var n=new Array(t);var s=0;for(var o=0,u=e.length;o<u;++o){var a=e[o],f=!r.isArray(a)?a.keys():a;for(var l=0,c=f.length;l<c;++l){n[s++]=f[l]}}return new i(n)};i.prototype.size=function(){return this._size};i.prototype.keys=function(){return s(this._keys)};i.prototype.has=function(e){return e in this._keys};i.prototype.add=function(e){if(!(e in this._keys)){this._keys[e]=e;++this._size;return true}return false};i.prototype.remove=function(e){if(e in this._keys){delete this._keys[e];--this._size;return true}return false}},{"./util":22}],22:[function(e,t,n){if(!Array.isArray){n.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}else{n.isArray=Array.isArray}if("function"!==typeof Array.prototype.reduce){n.reduce=function(e,t,n){"use strict";if(null===e||"undefined"===typeof e){throw new TypeError("Array.prototype.reduce called on null or undefined")}if("function"!==typeof t){throw new TypeError(t+" is not a function")}var r,i,s=e.length>>>0,o=false;if(1<arguments.length){i=n;o=true}for(r=0;s>r;++r){if(e.hasOwnProperty(r)){if(o){i=t(i,e[r],r,e)}else{i=e[r];o=true}}}if(!o){throw new TypeError("Reduce of empty array with no initial value")}return i}}else{n.reduce=function(e,t,n){return e.reduce(t,n)}}},{}],23:[function(e,t,n){t.exports="1.1.3"},{}],24:[function(e,t,n){n.Graph=e("./lib/Graph");n.Digraph=e("./lib/Digraph");n.CGraph=e("./lib/CGraph");n.CDigraph=e("./lib/CDigraph");e("./lib/graph-converters");n.alg={isAcyclic:e("./lib/alg/isAcyclic"),components:e("./lib/alg/components"),dijkstra:e("./lib/alg/dijkstra"),dijkstraAll:e("./lib/alg/dijkstraAll"),findCycles:e("./lib/alg/findCycles"),floydWarshall:e("./lib/alg/floydWarshall"),postorder:e("./lib/alg/postorder"),preorder:e("./lib/alg/preorder"),prim:e("./lib/alg/prim"),tarjan:e("./lib/alg/tarjan"),topsort:e("./lib/alg/topsort")};n.converter={json:e("./lib/converter/json.js")};var r=e("./lib/filter");n.filter={all:r.all,nodesFromList:r.nodesFromList};n.version=e("./lib/version")},{"./lib/CDigraph":26,"./lib/CGraph":27,"./lib/Digraph":28,"./lib/Graph":29,"./lib/alg/components":30,"./lib/alg/dijkstra":31,"./lib/alg/dijkstraAll":32,"./lib/alg/findCycles":33,"./lib/alg/floydWarshall":34,"./lib/alg/isAcyclic":35,"./lib/alg/postorder":36,"./lib/alg/preorder":37,"./lib/alg/prim":38,"./lib/alg/tarjan":39,"./lib/alg/topsort":40,"./lib/converter/json.js":42,"./lib/filter":43,"./lib/graph-converters":44,"./lib/version":46}],25:[function(e,t,n){function i(){this._value=undefined;this._nodes={};this._edges={};this._nextId=0}function s(e,t,n){(e[t]||(e[t]=new r)).add(n)}function o(e,t,n){var r=e[t];r.remove(n);if(r.size()===0){delete e[t]}}var r=e("cp-data").Set;t.exports=i;i.prototype.order=function(){return Object.keys(this._nodes).length};i.prototype.size=function(){return Object.keys(this._edges).length};i.prototype.graph=function(e){if(arguments.length===0){return this._value}this._value=e};i.prototype.hasNode=function(e){return e in this._nodes};i.prototype.node=function(e,t){var n=this._strictGetNode(e);if(arguments.length===1){return n.value}n.value=t};i.prototype.nodes=function(){var e=[];this.eachNode(function(t){e.push(t)});return e};i.prototype.eachNode=function(e){for(var t in this._nodes){var n=this._nodes[t];e(n.id,n.value)}};i.prototype.hasEdge=function(e){return e in this._edges};i.prototype.edge=function(e,t){var n=this._strictGetEdge(e);if(arguments.length===1){return n.value}n.value=t};i.prototype.edges=function(){var e=[];this.eachEdge(function(t){e.push(t)});return e};i.prototype.eachEdge=function(e){for(var t in this._edges){var n=this._edges[t];e(n.id,n.u,n.v,n.value)}};i.prototype.incidentNodes=function(e){var t=this._strictGetEdge(e);return[t.u,t.v]};i.prototype.addNode=function(e,t){if(e===undefined||e===null){do{e="_"+ ++this._nextId}while(this.hasNode(e))}else if(this.hasNode(e)){throw new Error("Graph already has node '"+e+"'")}this._nodes[e]={id:e,value:t};return e};i.prototype.delNode=function(e){this._strictGetNode(e);this.incidentEdges(e).forEach(function(e){this.delEdge(e)},this);delete this._nodes[e]};i.prototype._addEdge=function(e,t,n,r,i,o){this._strictGetNode(t);this._strictGetNode(n);if(e===undefined||e===null){do{e="_"+ ++this._nextId}while(this.hasEdge(e))}else if(this.hasEdge(e)){throw new Error("Graph already has edge '"+e+"'")}this._edges[e]={id:e,u:t,v:n,value:r};s(i[n],t,e);s(o[t],n,e);return e};i.prototype._delEdge=function(e,t,n){var r=this._strictGetEdge(e);o(t[r.v],r.u,e);o(n[r.u],r.v,e);delete this._edges[e]};i.prototype.copy=function(){var e=new this.constructor;e.graph(this.graph());this.eachNode(function(t,n){e.addNode(t,n)});this.eachEdge(function(t,n,r,i){e.addEdge(t,n,r,i)});e._nextId=this._nextId;return e};i.prototype.filterNodes=function(e){var t=new this.constructor;t.graph(this.graph());this.eachNode(function(n,r){if(e(n)){t.addNode(n,r)}});this.eachEdge(function(e,n,r,i){if(t.hasNode(n)&&t.hasNode(r)){t.addEdge(e,n,r,i)}});return t};i.prototype._strictGetNode=function(e){var t=this._nodes[e];if(t===undefined){throw new Error("Node '"+e+"' is not in graph")}return t};i.prototype._strictGetEdge=function(e){var t=this._edges[e];if(t===undefined){throw new Error("Edge '"+e+"' is not in graph")}return t}},{"cp-data":19}],26:[function(e,t,n){var r=e("./Digraph"),i=e("./compoundify");var s=i(r);t.exports=s;s.fromDigraph=function(e){var t=new s,n=e.graph();if(n!==undefined){t.graph(n)}e.eachNode(function(e,n){if(n===undefined){t.addNode(e)}else{t.addNode(e,n)}});e.eachEdge(function(e,n,r,i){if(i===undefined){t.addEdge(null,n,r)}else{t.addEdge(null,n,r,i)}});return t};s.prototype.toString=function(){return"CDigraph "+JSON.stringify(this,null,2)}},{"./Digraph":28,"./compoundify":41}],27:[function(e,t,n){var r=e("./Graph"),i=e("./compoundify");var s=i(r);t.exports=s;s.fromGraph=function(e){var t=new s,n=e.graph();if(n!==undefined){t.graph(n)}e.eachNode(function(e,n){if(n===undefined){t.addNode(e)}else{t.addNode(e,n)}});e.eachEdge(function(e,n,r,i){if(i===undefined){t.addEdge(null,n,r)}else{t.addEdge(null,n,r,i)}});return t};s.prototype.toString=function(){return"CGraph "+JSON.stringify(this,null,2)}},{"./Graph":29,"./compoundify":41}],28:[function(e,t,n){function o(){i.call(this);this._inEdges={};this._outEdges={}}var r=e("./util"),i=e("./BaseGraph"),s=e("cp-data").Set;t.exports=o;o.prototype=new i;o.prototype.constructor=o;o.prototype.isDirected=function(){return true};o.prototype.successors=function(e){this._strictGetNode(e);return Object.keys(this._outEdges[e]).map(function(e){return this._nodes[e].id},this)};o.prototype.predecessors=function(e){this._strictGetNode(e);return Object.keys(this._inEdges[e]).map(function(e){return this._nodes[e].id},this)};o.prototype.neighbors=function(e){return s.union([this.successors(e),this.predecessors(e)]).keys()};o.prototype.sources=function(){var e=this;return this._filterNodes(function(t){return e.inEdges(t).length===0})};o.prototype.sinks=function(){var e=this;return this._filterNodes(function(t){return e.outEdges(t).length===0})};o.prototype.source=function(e){return this._strictGetEdge(e).u};o.prototype.target=function(e){return this._strictGetEdge(e).v};o.prototype.inEdges=function(e,t){this._strictGetNode(e);var n=s.union(r.values(this._inEdges[e])).keys();if(arguments.length>1){this._strictGetNode(t);n=n.filter(function(e){return this.source(e)===t},this)}return n};o.prototype.outEdges=function(e,t){this._strictGetNode(e);var n=s.union(r.values(this._outEdges[e])).keys();if(arguments.length>1){this._strictGetNode(t);n=n.filter(function(e){return this.target(e)===t},this)}return n};o.prototype.incidentEdges=function(e,t){if(arguments.length>1){return s.union([this.outEdges(e,t),this.outEdges(t,e)]).keys()}else{return s.union([this.inEdges(e),this.outEdges(e)]).keys()}};o.prototype.toString=function(){return"Digraph "+JSON.stringify(this,null,2)};o.prototype.addNode=function(e,t){e=i.prototype.addNode.call(this,e,t);this._inEdges[e]={};this._outEdges[e]={};return e};o.prototype.delNode=function(e){i.prototype.delNode.call(this,e);delete this._inEdges[e];delete this._outEdges[e]};o.prototype.addEdge=function(e,t,n,r){return i.prototype._addEdge.call(this,e,t,n,r,this._inEdges,this._outEdges)};o.prototype.delEdge=function(e){i.prototype._delEdge.call(this,e,this._inEdges,this._outEdges)};o.prototype._filterNodes=function(e){var t=[];this.eachNode(function(n){if(e(n)){t.push(n)}});return t}},{"./BaseGraph":25,"./util":45,"cp-data":19}],29:[function(e,t,n){function o(){i.call(this);this._incidentEdges={}}var r=e("./util"),i=e("./BaseGraph"),s=e("cp-data").Set;t.exports=o;o.prototype=new i;o.prototype.constructor=o;o.prototype.isDirected=function(){return false};o.prototype.neighbors=function(e){this._strictGetNode(e);return Object.keys(this._incidentEdges[e]).map(function(e){return this._nodes[e].id},this)};o.prototype.incidentEdges=function(e,t){this._strictGetNode(e);if(arguments.length>1){this._strictGetNode(t);return t in this._incidentEdges[e]?this._incidentEdges[e][t].keys():[]}else{return s.union(r.values(this._incidentEdges[e])).keys()}};o.prototype.toString=function(){return"Graph "+JSON.stringify(this,null,2)};o.prototype.addNode=function(e,t){e=i.prototype.addNode.call(this,e,t);this._incidentEdges[e]={};return e};o.prototype.delNode=function(e){i.prototype.delNode.call(this,e);delete this._incidentEdges[e]};o.prototype.addEdge=function(e,t,n,r){return i.prototype._addEdge.call(this,e,t,n,r,this._incidentEdges,this._incidentEdges)};o.prototype.delEdge=function(e){i.prototype._delEdge.call(this,e,this._incidentEdges,this._incidentEdges)}},{"./BaseGraph":25,"./util":45,"cp-data":19}],30:[function(e,t,n){function i(e){function i(t,r){if(!n.has(t)){n.add(t);r.push(t);e.neighbors(t).forEach(function(e){i(e,r)})}}var t=[];var n=new r;e.nodes().forEach(function(e){var n=[];i(e,n);if(n.length>0){t.push(n)}});return t}var r=e("cp-data").Set;t.exports=i},{"cp-data":19}],31:[function(e,t,n){function i(e,t,n,i){function u(t){var r=e.incidentNodes(t),i=r[0]!==a?r[0]:r[1],u=s[i],l=n(t),c=f.distance+l;if(l<0){throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+t+" Weight: "+l)}if(c<u.distance){u.distance=c;u.predecessor=a;o.decrease(i,c)}}var s={},o=new r;n=n||function(){return 1};i=i||(e.isDirected()?function(t){return e.outEdges(t)}:function(t){return e.incidentEdges(t)});e.eachNode(function(e){var n=e===t?0:Number.POSITIVE_INFINITY;s[e]={distance:n};o.add(e,n)});var a,f;while(o.size()>0){a=o.removeMin();f=s[a];if(f.distance===Number.POSITIVE_INFINITY){break}i(a).forEach(u)}return s}var r=e("cp-data").PriorityQueue;t.exports=i},{"cp-data":19}],32:[function(e,t,n){function i(e,t,n){var i={};e.eachNode(function(s){i[s]=r(e,s,t,n)});return i}var r=e("./dijkstra");t.exports=i},{"./dijkstra":31}],33:[function(e,t,n){function i(e){return r(e).filter(function(e){return e.length>1})}var r=e("./tarjan");t.exports=i},{"./tarjan":39}],34:[function(e,t,n){function r(e,t,n){var r={},i=e.nodes();t=t||function(){return 1};n=n||(e.isDirected()?function(t){return e.outEdges(t)}:function(t){return e.incidentEdges(t)});i.forEach(function(s){r[s]={};r[s][s]={distance:0};i.forEach(function(e){if(s!==e){r[s][e]={distance:Number.POSITIVE_INFINITY}}});n(s).forEach(function(n){var i=e.incidentNodes(n),o=i[0]!==s?i[0]:i[1],a=t(n);if(a<r[s][o].distance){r[s][o]={distance:a,predecessor:s}}})});i.forEach(function(e){var t=r[e];i.forEach(function(n){var s=r[n];i.forEach(function(n){var r=s[e];var i=t[n];var o=s[n];var u=r.distance+i.distance;if(u<o.distance){o.distance=u;o.predecessor=i.predecessor}})})});return r}t.exports=r},{}],35:[function(e,t,n){function i(e){try{r(e)}catch(t){if(t instanceof r.CycleException)return false;throw t}return true}var r=e("./topsort");t.exports=i},{"./topsort":40}],36:[function(e,t,n){function i(e,t,n){function s(t,r){if(i.has(t)){throw new Error("The input graph is not a tree: "+e)}i.add(t);e.neighbors(t).forEach(function(e){if(e!==r)s(e,t)});n(t)}var i=new r;if(e.isDirected()){throw new Error("This function only works for undirected graphs")}s(t)}var r=e("cp-data").Set;t.exports=i},{"cp-data":19}],37:[function(e,t,n){function i(e,t,n){function s(t,r){if(i.has(t)){throw new Error("The input graph is not a tree: "+e)}i.add(t);n(t);e.neighbors(t).forEach(function(e){if(e!==r)s(e,t)})}var i=new r;if(e.isDirected()){throw new Error("This function only works for undirected graphs")}s(t)}var r=e("cp-data").Set;t.exports=i},{"cp-data":19}],38:[function(e,t,n){function s(e,t){function a(n){var r=e.incidentNodes(n),i=r[0]!==u?r[0]:r[1],a=o.priority(i);if(a!==undefined){var f=t(n);if(f<a){s[i]=u;o.decrease(i,f)}}}var n=new r,s={},o=new i,u;if(e.order()===0){return n}e.eachNode(function(e){o.add(e,Number.POSITIVE_INFINITY);n.addNode(e)});o.decrease(e.nodes()[0],0);var f=false;while(o.size()>0){u=o.removeMin();if(u in s){n.addEdge(null,u,s[u])}else if(f){throw new Error("Input graph is not connected: "+e)}else{f=true}e.incidentEdges(u).forEach(a)}return n}var r=e("../Graph"),i=e("cp-data").PriorityQueue;t.exports=s},{"../Graph":29,"cp-data":19}],39:[function(e,t,n){function r(e){function s(o){var u=r[o]={onStack:true,lowlink:t,index:t++};n.push(o);e.successors(o).forEach(function(e){if(!(e in r)){s(e);u.lowlink=Math.min(u.lowlink,r[e].lowlink)}else if(r[e].onStack){u.lowlink=Math.min(u.lowlink,r[e].index)}});if(u.lowlink===u.index){var a=[],f;do{f=n.pop();r[f].onStack=false;a.push(f)}while(o!==f);i.push(a)}}if(!e.isDirected()){throw new Error("tarjan can only be applied to a directed graph. Bad input: "+e)}var t=0,n=[],r={},i=[];e.nodes().forEach(function(e){if(!(e in r)){s(e)}});return i}t.exports=r},{}],40:[function(e,t,n){function r(e){function s(o){if(o in n){throw new i}if(!(o in t)){n[o]=true;t[o]=true;e.predecessors(o).forEach(function(e){s(e)});delete n[o];r.push(o)}}if(!e.isDirected()){throw new Error("topsort can only be applied to a directed graph. Bad input: "+e)}var t={};var n={};var r=[];var o=e.sinks();if(e.order()!==0&&o.length===0){throw new i}e.sinks().forEach(function(e){s(e)});return r}function i(){}t.exports=r;r.CycleException=i;i.prototype.toString=function(){return"Graph has at least one cycle"}},{}],41:[function(e,t,n){function i(e){function t(){e.call(this);this._parents={};this._children={};this._children[null]=new r}t.prototype=new e;t.prototype.constructor=t;t.prototype.parent=function(e,t){this._strictGetNode(e);if(arguments.length<2){return this._parents[e]}if(e===t){throw new Error("Cannot make "+e+" a parent of itself")}if(t!==null){this._strictGetNode(t)}this._children[this._parents[e]].remove(e);this._parents[e]=t;this._children[t].add(e)};t.prototype.children=function(e){if(e!==null){this._strictGetNode(e)}return this._children[e].keys()};t.prototype.addNode=function(t,n){t=e.prototype.addNode.call(this,t,n);this._parents[t]=null;this._children[t]=new r;this._children[null].add(t);return t};t.prototype.delNode=function(t){var n=this.parent(t);this._children[t].keys().forEach(function(e){this.parent(e,n)},this);this._children[n].remove(t);delete this._parents[t];delete this._children[t];return e.prototype.delNode.call(this,t)};t.prototype.copy=function(){var t=e.prototype.copy.call(this);this.nodes().forEach(function(e){t.parent(e,this.parent(e))},this);return t};t.prototype.filterNodes=function(t){function s(e){var t=n.parent(e);if(t===null||r.hasNode(t)){i[e]=t;return t}else if(t in i){return i[t]}else{return s(t)}}var n=this,r=e.prototype.filterNodes.call(this,t);var i={};r.eachNode(function(e){r.parent(e,s(e))});return r};return t}var r=e("cp-data").Set;t.exports=i},{"cp-data":19}],42:[function(e,t,n){function u(e){return Object.prototype.toString.call(e).slice(8,-1)}var r=e("../Graph"),i=e("../Digraph"),s=e("../CGraph"),o=e("../CDigraph");n.decode=function(e,t,n){n=n||i;if(u(e)!=="Array"){throw new Error("nodes is not an Array")}if(u(t)!=="Array"){throw new Error("edges is not an Array")}if(typeof n==="string"){switch(n){case"graph":n=r;break;case"digraph":n=i;break;case"cgraph":n=s;break;case"cdigraph":n=o;break;default:throw new Error("Unrecognized graph type: "+n)}}var a=new n;e.forEach(function(e){a.addNode(e.id,e.value)});if(a.parent){e.forEach(function(e){if(e.children){e.children.forEach(function(t){a.parent(t,e.id)})}})}t.forEach(function(e){a.addEdge(e.id,e.u,e.v,e.value)});return a};n.encode=function(e){var t=[];var n=[];e.eachNode(function(n,r){var i={id:n,value:r};if(e.children){var s=e.children(n);if(s.length){i.children=s}}t.push(i)});e.eachEdge(function(e,t,r,i){n.push({id:e,u:t,v:r,value:i})});var u;if(e instanceof o){u="cdigraph"}else if(e instanceof s){u="cgraph"}else if(e instanceof i){u="digraph"}else if(e instanceof r){u="graph"}else{throw new Error("Couldn't determine type of graph: "+e)}return{nodes:t,edges:n,type:u}}},{"../CDigraph":26,"../CGraph":27,"../Digraph":28,"../Graph":29}],43:[function(e,t,n){var r=e("cp-data").Set;n.all=function(){return function(){return true}};n.nodesFromList=function(e){var t=new r(e);return function(e){return t.has(e)}}},{"cp-data":19}],44:[function(e,t,n){var r=e("./Graph"),i=e("./Digraph");r.prototype.toDigraph=r.prototype.asDirected=function(){var e=new i;this.eachNode(function(t,n){e.addNode(t,n)});this.eachEdge(function(t,n,r,i){e.addEdge(null,n,r,i);e.addEdge(null,r,n,i)});return e};i.prototype.toGraph=i.prototype.asUndirected=function(){var e=new r;this.eachNode(function(t,n){e.addNode(t,n)});this.eachEdge(function(t,n,r,i){e.addEdge(t,n,r,i)});return e}},{"./Digraph":28,"./Graph":29}],45:[function(e,t,n){n.values=function(e){var t=Object.keys(e),n=t.length,r=new Array(n),i;for(i=0;i<n;++i){r[i]=e[t[i]]}return r}},{}],46:[function(e,t,n){t.exports="0.7.4"},{}]},{},[1]);joint.layout.DirectedGraph={layout:function(e,t){t=t||{};var n=this._prepareData(e);var r=dagre.layout();if(t.debugLevel){r.debugLevel(t.debugLevel)}if(t.rankDir){r.rankDir(t.rankDir)}if(t.rankSep){r.rankSep(t.rankSep)}if(t.edgeSep){r.edgeSep(t.edgeSep)}if(t.nodeSep){r.nodeSep(t.nodeSep)}var i=r.run(n);i.eachNode(function(n,r){if(!r.dummy){var i=e.getCell(n);t.setPosition?t.setPosition(i,r):e.get("cells").get(n).set("position",{x:r.x-r.width/2,y:r.y-r.height/2})}});if(t.setLinkVertices){i.eachEdge(function(n,r,i,s){var o=e.getCell(n);if(o){t.setVertices?t.setVertices(o,s.points):o.set("vertices",s.points)}})}return{width:i.graph().width,height:i.graph().height}},_prepareData:function(e){var t=new dagre.Digraph;_.each(e.getElements(),function(e){if(t.hasNode(e.id))return;t.addNode(e.id,{width:e.get("size").width,height:e.get("size").height,rank:e.get("rank")})});_.each(e.getLinks(),function(e){if(t.hasEdge(e.id))return;var n=e.get("source").id;var r=e.get("target").id;t.addEdge(e.id,n,r,{minLen:e.get("minLen")||1})});return t}}